"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _vue=require("vue"),_xeUtils=_interopRequireDefault(require("xe-utils")),_conf=_interopRequireDefault(require("../../v-x-e-table/src/conf")),_size=require("../../hooks/size"),_utils=require("../../tools/utils"),_dom=require("../../tools/dom"),_vn=require("../../tools/vn");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var __assign=function(){return(__assign=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},__spreadArray=function(e,t,n){if(n||2===arguments.length)for(var i,o=0,r=t.length;o<r;o++)!i&&o in t||((i=i||Array.prototype.slice.call(t,0,o))[o]=t[o]);return e.concat(i||Array.prototype.slice.call(t))},_default=(0,_vue.defineComponent)({name:"VxeTooltip",props:{modelValue:Boolean,size:{type:String,default:function(){return _conf.default.tooltip.size||_conf.default.size}},trigger:{type:String,default:function(){return _conf.default.tooltip.trigger}},theme:{type:String,default:function(){return _conf.default.tooltip.theme}},content:{type:[String,Number],default:null},useHTML:Boolean,zIndex:[String,Number],isArrow:{type:Boolean,default:!0},enterable:Boolean,enterDelay:{type:Number,default:function(){return _conf.default.tooltip.enterDelay}},leaveDelay:{type:Number,default:function(){return _conf.default.tooltip.leaveDelay}}},emits:["update:modelValue"],setup:function(c,e){function n(){var e,t,n,i,o,r,l,u,a,c=d.tipTarget,s=d.tipStore;c&&(e=(n=(0,_dom.getDomNode)()).scrollTop,t=n.scrollLeft,n=n.visibleWidth,i=(o=(0,_dom.getAbsolutePos)(c)).top,o=o.left,r=(l=_.value).offsetHeight,l=l.offsetWidth,a=o,u=i-r-6,t+n<(a=Math.max(6,o+Math.floor((c.offsetWidth-l)/2)))+l+6&&(a=t+n-l-6),i-r<e+6&&(s.placement="bottom",u=i+c.offsetHeight+6),s.style.top="".concat(u,"px"),s.style.left="".concat(a,"px"),s.arrowStyle.left="".concat(o-a+c.offsetWidth/2,"px"))}function i(e){e!==d.visible&&(d.visible=e,d.isUpdate=!0,a("update:modelValue",e))}function r(){d.visible?y.close():y.open()}function l(){y.open()}function u(){var e=c.trigger,t=c.enterable,n=c.leaveDelay;d.tipActive=!1,t&&"hover"===e?setTimeout(function(){d.tipActive||y.close()},n):y.close()}function s(){d.tipActive=!0}function p(){var e=c.trigger,t=c.enterable,n=c.leaveDelay;d.tipActive=!1,t&&"hover"===e&&setTimeout(function(){d.tipActive||y.close()},n)}function o(){var e=d.tipStore,t=_.value;return t&&!t.parentNode&&document.body.appendChild(t),i(!0),d.tipZindex<(0,_utils.getLastZIndex)()&&(d.tipZindex=(0,_utils.nextZIndex)()),e.placement="top",e.style={width:"auto",left:0,top:0,zIndex:c.zIndex||d.tipZindex},e.arrowStyle={left:"50%"},y.updatePlacement()}var f=e.slots,a=e.emit,t=_xeUtils.default.uniqueId(),v=(0,_size.useSize)(c),d=(0,_vue.reactive)({target:null,isUpdate:!1,visible:!1,tipContent:"",tipActive:!1,tipTarget:null,tipZindex:0,tipStore:{style:{},placement:"",arrowStyle:{}}}),_=(0,_vue.ref)(),g={refElem:_},m={xID:t,props:c,context:e,reactData:d,getRefMaps:function(){return g}},y={},h=_xeUtils.default.debounce(function(){d.tipActive&&o()},c.enterDelay,{leading:!1,trailing:!0}),y={dispatchEvent:function(e,t,n){a(e,Object.assign({$tooltip:m,$event:n},t))},open:function(e,t){return y.toVisible(e||d.target,t)},close:function(){return d.tipTarget=null,d.tipActive=!1,Object.assign(d.tipStore,{style:{},placement:"",arrowStyle:null}),i(!1),(0,_vue.nextTick)()},toVisible:function(e,t){if(e){var n=c.trigger,i=c.enterDelay;if(d.tipActive=!0,d.tipTarget=e,t&&(d.tipContent=t),!i||"hover"!==n)return o();h()}return(0,_vue.nextTick)()},updatePlacement:function(){return(0,_vue.nextTick)().then(function(){var e=d.tipTarget,t=_.value;if(e&&t)return n(),(0,_vue.nextTick)().then(n)})},isActived:function(){return d.tipActive},setActived:function(e){d.tipActive=!!e}};Object.assign(m,y),(0,_vue.watch)(function(){return c.content},function(){d.tipContent=c.content}),(0,_vue.watch)(function(){return c.modelValue},function(){d.isUpdate||(c.modelValue?y.open():y.close()),d.isUpdate=!1}),(0,_vue.onMounted)(function(){(0,_vue.nextTick)(function(){var e=c.trigger,t=c.content,n=c.modelValue,i=_.value,o=i.parentNode;o&&(d.tipContent=t,d.tipZindex=(0,_utils.nextZIndex)(),_xeUtils.default.arrayEach(i.children,function(e,t){1<t&&(o.insertBefore(e,i),d.target||(d.target=e))}),o.removeChild(i),(t=d.target)&&("hover"===e?(t.onmouseenter=l,t.onmouseleave=u):"click"===e&&(t.onclick=r)),n)&&y.open()})}),(0,_vue.onBeforeUnmount)(function(){var e,t=c.trigger,n=d.target,i=_.value;i&&(e=i.parentNode)&&e.removeChild(i),n&&("hover"===t?(n.onmouseenter=null,n.onmouseleave=null):"click"===t&&(n.onclick=null))});return m.renderVN=function(){var e,t=c.theme,n=c.isArrow,i=c.enterable,o=d.tipActive,r=d.visible,l=d.tipStore,u=f.default,a=v.value;return i&&(e={onMouseenter:s,onMouseleave:p}),(0,_vue.h)("div",__assign({ref:_,class:["vxe-table--tooltip-wrapper","theme--".concat(t),((t={})["size--".concat(a)]=a,t["placement--".concat(l.placement)]=l.placement,t["is--enterable"]=i,t["is--visible"]=r,t["is--arrow"]=n,t["is--actived"]=o,t)],style:l.style},e),__spreadArray([(a=c.useHTML,i=d.tipContent,(r=f.content)?(0,_vue.h)("div",{key:1,class:"vxe-table--tooltip-content"},(0,_vn.getSlotVNs)(r({}))):a?(0,_vue.h)("div",{key:2,class:"vxe-table--tooltip-content",innerHTML:i}):(0,_vue.h)("div",{key:3,class:"vxe-table--tooltip-content"},(0,_utils.formatText)(i))),(0,_vue.h)("div",{class:"vxe-table--tooltip-arrow",style:l.arrowStyle})],u?(0,_vn.getSlotVNs)(u({})):[],!0))},m},render:function(){return this.renderVN()}});exports.default=_default;