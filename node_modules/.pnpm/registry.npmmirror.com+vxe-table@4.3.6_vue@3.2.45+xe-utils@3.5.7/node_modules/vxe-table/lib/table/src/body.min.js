"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _vue=require("vue"),_xeUtils=_interopRequireDefault(require("xe-utils")),_conf=_interopRequireDefault(require("../../v-x-e-table/src/conf")),_vXETable=require("../../v-x-e-table"),_util=require("./util"),_dom=require("../../tools/dom"),_utils=require("../../tools/utils"),_vn=require("../../tools/vn");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var __assign=function(){return(__assign=Object.assign||function(e){for(var l,t=1,o=arguments.length;t<o;t++)for(var a in l=arguments[t])Object.prototype.hasOwnProperty.call(l,a)&&(e[a]=l[a]);return e}).apply(this,arguments)},__spreadArray=function(e,l,t){if(t||2===arguments.length)for(var o,a=0,n=l.length;a<n;a++)!o&&a in l||((o=o||Array.prototype.slice.call(l,0,a))[a]=l[a]);return e.concat(o||Array.prototype.slice.call(l))},renderType="body",lineOffsetSizes={mini:3,small:2,medium:1},_default=(0,_vue.defineComponent)({name:"VxeTableBody",props:{tableData:Array,tableColumn:Array,fixedColumn:Array,fixedType:{type:String,default:null}},setup:function(m){function c(){if(l){var e=l.value;if(e)return lineOffsetSizes[e]||0}return 0}function u(e,l){var t=1;if(e){var o=e[d.value.children];if(ne.isTreeExpandByRow(e))for(var a=0;a<o.length;a++)t+=u(o[a],l)}return t}function ae(e){var l=e.row,t=e.column,o=re.treeConfig,a=d.value,n=t.slots,t=t.treeNode,l=se.fullAllDataRowIdData[(0,_util.getRowid)(ne,l)],r=0,i=0,s=[];return l&&(r=l.level,i=l._index,s=l.items),n&&n.line?ne.callSlot(n.line,e):o&&t&&a.line?[(0,_vue.h)("div",{class:"vxe-tree--line-wrapper"},[(0,_vue.h)("div",{class:"vxe-tree--line",style:{height:"".concat((l=e,n=s,o=1,(t=i)&&(o=u(n[t-1],l)),ie.rowHeight*o-(t?1:12-c())),"px"),left:"".concat(r*a.indent+(r?2-c():0)+16,"px")}})])]:[]}function _(e,l,t,o){(t||o)&&(t&&((0,_util.removeScrollListener)(t),t.scrollTop=l),o&&((0,_util.removeScrollListener)(o),o.scrollTop=l),clearTimeout(a),a=setTimeout(function(){(0,_util.restoreScrollListener)(t),(0,_util.restoreScrollListener)(o)},300))}function o(e){var l=m.fixedType,t=re.highlightHoverRow,o=ie.scrollXLoad,a=ie.scrollYLoad,n=se.elemStore,r=se.lastScrollTop,i=se.lastScrollLeft,s=ve.value,c=U.value,u=w.value,d=A.value,v=b.value,p=T.value,f=X.value,h=S.value,c=c?c.$el:null,d=d?d.$el:null,u=u.$el,v=v?v.$el:null,p=p?p.$el:null,x=(x=n["main-body-ySpace"])?x.value:null,n=(n=n["main-body-xSpace"])?n.value:null,x=(a&&x?x:u).clientHeight,n=(o&&n?n:u).clientWidth,h=h.scrollTop,g=u.scrollLeft,i=g!==i,r=h!==r;se.lastScrollTop=h,se.lastScrollLeft=g,se.lastScrollTime=Date.now(),(s.isHover||t)&&ne.clearHoverRow(),v&&"left"===l?(h=v.scrollTop,_(0,h,u,p)):p&&"right"===l?(h=p.scrollTop,_(0,h,u,v)):(i&&(c&&(c.scrollLeft=u.scrollLeft),d)&&(d.scrollLeft=u.scrollLeft),(v||p)&&(ne.checkScrolling(),r)&&_(0,h,v,p)),o&&i&&ne.triggerScrollXEvent(e),a&&r&&ne.triggerScrollYEvent(e),i&&f&&f.reactData.visible&&f.updatePlacement(),ne.dispatchEvent("scroll",{type:renderType,fixed:l,scrollTop:h,scrollLeft:g,scrollHeight:u.scrollHeight,scrollWidth:u.scrollWidth,bodyHeight:x,bodyWidth:n,isX:i,isY:r},e)}function k(e){var l=e.deltaY,t=e.deltaX,o=re.highlightHoverRow,a=ie.scrollYLoad,n=se.lastScrollTop,r=se.lastScrollLeft,i=ve.value,s=w.value,c=S.value,s=s.$el,u=l<0;(u?c.scrollTop<=0:c.scrollTop>=c.scrollHeight-c.clientHeight)||(c=c.scrollTop+l,t=(s=s.scrollLeft+t)!==r,(r=c!==n)&&(e.preventDefault(),se.lastScrollTop=c,se.lastScrollLeft=s,se.lastScrollTime=Date.now(),(i.isHover||o)&&ne.clearHoverRow(),v(e,u,l,t,r),a)&&ne.triggerScrollYEvent(e))}var a,g,ne=(0,_vue.inject)("$xetable",{}),l=(0,_vue.inject)("xesize",null),y=ne.xID,re=ne.props,q=ne.context,ie=ne.reactData,se=ne.internalData,e=ne.getRefMaps(),U=e.refTableHeader,w=e.refTableBody,A=e.refTableFooter,b=e.refTableLeftBody,T=e.refTableRightBody,X=e.refValidTooltip,e=ne.getComputeMaps(),ce=e.computeEditOpts,Y=e.computeMouseOpts,ue=e.computeSYOpts,W=e.computeEmptyOpts,N=e.computeKeyboardOpts,fe=e.computeTooltipOpts,t=e.computeRadioOpts,V=e.computeExpandOpts,d=e.computeTreeOpts,de=e.computeCheckboxOpts,he=e.computeValidOpts,ve=e.computeRowOpts,xe=e.computeColumnOpts,S=(0,_vue.ref)(),C=(0,_vue.ref)(),O=(0,_vue.ref)(),L=(0,_vue.ref)(),R=(0,_vue.ref)(),E=(0,_vue.ref)(),H=(0,_vue.ref)(),pe=function(){var e=re.delayHover,l=se.lastScrollTime;return se._isResize||l&&Date.now()<l+e},j=function(e,l,t,q,o,a,n,r,i,s,U,A){var c,B=re.columnKey,u=re.height,d=re.showOverflow,X=re.cellClassName,v=re.cellStyle,p=re.align,f=re.spanMethod,Y=re.mouseConfig,W=re.editConfig,N=re.editRules,V=re.tooltipConfig,j=ie.tableData,h=ie.overflowX,P=ie.scrollYLoad,F=ie.currentColumn,x=ie.mergeList,g=ie.editStore,m=ie.validStore,K=ie.isAllOverflow,z=se.afterFullData,_=he.value,G=de.value,y=ce.value,w=fe.value,b=ve.value,T=ue.value,J=xe.value,Q=i.type,Z=i.cellRender,S=i.editRender,C=i.align,O=i.showOverflow,ee=i.className,le=i.treeNode,g=g.actived,T=T.rHeight,b=b.height,L=S||Z,L=L?_vXETable.VXETable.renderer.get(L.name):null,L=L?L.cellClassName:"",R=w.showAll,w=ne.getColumnIndex(i),te=ne.getVTColumnIndex(i),oe=(0,_utils.isEnableConf)(S),h=t?i.fixed!==t:i.fixed&&h,O=_xeUtils.default.isUndefined(O)||_xeUtils.default.isNull(O)?d:O,E="ellipsis"===O,H="title"===O,I=!0===O||"tooltip"===O,O=H||I||E,D={},C=C||p,p=m.row===o&&m.column===i,N=N&&_.showMessage&&("default"===_.message?u||1<j.length:"inline"===_.message),u={colid:i.id},M={$table:ne,seq:e,rowid:l,row:o,rowIndex:a,$rowIndex:n,_rowIndex:r,column:i,columnIndex:w,$columnIndex:s,_columnIndex:te,fixed:t,type:renderType,isHidden:h,level:q,visibleData:z,data:j,items:A};if(P&&!O&&(E=O=!0),(H||I||R||V)&&(D.onMouseenter=function(e){pe()||(H?(0,_dom.updateCellTitle)(e.currentTarget,i):(I||R)&&ne.triggerBodyTooltipEvent(e,M),ne.dispatchEvent("cell-mouseenter",Object.assign({cell:e.currentTarget},M),e))}),(I||R||V)&&(D.onMouseleave=function(e){pe()||((I||R)&&ne.handleTargetLeaveEvent(e),ne.dispatchEvent("cell-mouseleave",Object.assign({cell:e.currentTarget},M),e))}),(G.range||Y)&&(D.onMousedown=function(e){ne.triggerCellMousedownEvent(e,M)}),D.onClick=function(e){ne.triggerCellClickEvent(e,M)},D.onDblclick=function(e){ne.triggerCellDblclickEvent(e,M)},x.length){_=(0,_util.mergeBodyMethod)(x,r,te);if(_){var $=_.rowspan,k=_.colspan;if(!$||!k)return null;1<$&&(u.rowspan=$),1<k&&(u.colspan=k)}}else if(f){e=f(M)||{},l=e.rowspan,$=void 0===l?1:l,a=e.colspan,k=void 0===a?1:a;if(!$||!k)return null;1<$&&(u.rowspan=$),1<k&&(u.colspan=k)}!(h=h&&x&&(1<u.colspan||1<u.rowspan)?!1:h)&&W&&(S||Z)&&(y.showStatus||y.showUpdateStatus)&&(c=ne.isUpdateByRow(o,i.field));n=[];return h&&d&&K?n.push((0,_vue.h)("div",{class:["vxe-cell",{"c--title":H,"c--tooltip":I,"c--ellipsis":E}],style:{maxHeight:O&&(T||b)?"".concat(T||b,"px"):""}})):(n.push.apply(n,__spreadArray(__spreadArray([],ae(M),!1),[(0,_vue.h)("div",{class:["vxe-cell",{"c--title":H,"c--tooltip":I,"c--ellipsis":E}],style:{maxHeight:O&&(T||b)?"".concat(T||b,"px"):""},title:H?ne.getCellLabel(o,i):null},i.renderCell(M))],!1)),N&&p&&n.push((0,_vue.h)("div",{class:"vxe-cell--valid",style:m.rule&&m.rule.maxWidth?{width:"".concat(m.rule.maxWidth,"px")}:null},[(0,_vue.h)("span",{class:"vxe-cell--valid-msg"},m.content)]))),(0,_vue.h)("td",__assign(__assign(__assign({class:["vxe-body--column",i.id,((w={})["col--".concat(C)]=C,w["col--".concat(Q)]=Q,w["col--last"]=s===U.length-1,w["col--tree-node"]=le,w["col--edit"]=oe,w["col--ellipsis"]=O,w["fixed--hidden"]=h,w["col--dirty"]=c,w["col--actived"]=W&&oe&&g.row===o&&(g.column===i||"row"===y.mode),w["col--valid-error"]=p,w["col--current"]=F===i,w),(0,_dom.getPropClass)(L,M),(0,_dom.getPropClass)(ee,M),(0,_dom.getPropClass)(X,M)],key:B||J.useKey?i.id:s},u),{style:Object.assign({height:O&&(T||b)?"".concat(T||b,"px"):""},v?_xeUtils.default.isFunction(v)?v(M):v:null)}),D),n)},B=function(p,f,h){var x=re.stripe,g=re.rowKey,m=re.highlightHoverRow,_=re.rowClassName,y=re.rowStyle,w=re.showOverflow,b=re.editConfig,T=re.treeConfig,S=ie.hasFixedColumn,C=ie.treeExpandeds,O=ie.scrollYLoad,L=ie.editStore,R=ie.rowExpandeds,E=ie.expandColumn,H=ie.selectRow,I=se.fullAllDataRowIdData,D=de.value,M=t.value,$=d.value,k=ce.value,q=ve.value,U=$.transform,A=[];return f.forEach(function(t,o){var e,l={},a=ne.getRowIndex(t),n=((q.isHover||m)&&(l.onMouseenter=function(e){pe()||ne.triggerHoverEvent(e,{row:t,rowIndex:a})},l.onMouseleave=function(){pe()||ne.clearHoverRow()}),(0,_util.getRowid)(ne,t)),r=I[n],i=0,s=-1,c=0,r=(r&&(i=r.level,s=r.seq,c=r._index),{$table:ne,seq:s,rowid:n,fixed:p,type:renderType,level:i,row:t,rowIndex:a,$rowIndex:o,_rowIndex:c}),u=E&&R.length&&-1<ne.findRowIndexOf(R,t),d=!1,v=!1;b&&(v=-1<ne.findRowIndexOf(L.insertList,t)),T&&!O&&!U&&C.length&&(d=(e=t[$.children])&&e.length&&-1<ne.findRowIndexOf(C,t)),A.push((0,_vue.h)("tr",__assign({class:["vxe-body--row",T?"row--level-".concat(i):"",{"row--stripe":x&&(ne.getVTRowIndex(t)+1)%2==0,"is--new":v,"is--expand-row":u,"is--expand-tree":d,"row--new":v&&(k.showStatus||k.showInsertStatus),"row--radio":M.highlight&&H===t,"row--checked":D.highlight&&ne.isCheckedByCheckboxRow(t)},(0,_dom.getPropClass)(_,r)],rowid:n,style:y?_xeUtils.default.isFunction(y)?y(r):y:null,key:g||q.useKey||T?n:o},l),h.map(function(e,l){return j(s,n,p,i,t,a,o,c,e,l,h,f)}))),u&&(e={},(d=V.value.height)&&(e.height="".concat(d,"px")),T&&(e.paddingLeft="".concat(i*$.indent+30,"px")),v=E.showOverflow,r=_xeUtils.default.isUndefined(v)||_xeUtils.default.isNull(v)?w:v,u={$table:ne,seq:s,column:E,fixed:p,type:renderType,level:i,row:t,rowIndex:a,$rowIndex:o,_rowIndex:c},A.push((0,_vue.h)("tr",__assign({class:"vxe-body--expanded-row",key:"expand_".concat(n),style:y?_xeUtils.default.isFunction(y)?y(u):y:null},l),[(0,_vue.h)("td",{class:{"vxe-body--expanded-column":1,"fixed--hidden":p&&!S,"col--ellipsis":r},colspan:h.length},[(0,_vue.h)("div",{class:{"vxe-body--expanded-cell":1,"is--ellipsis":d},style:e},[E.renderData(u)])])]))),T&&!O&&!U&&C.length&&(v=t[$.children])&&v.length&&-1<ne.findRowIndexOf(C,t)&&A.push.apply(A,B(p,v,h))}),A},I=0,D=0,M=0,$=!1,v=function(a,n,e,r,i){function s(){var e,l,t,o;M<I&&(e=m.fixedType,D=Math.max(5,Math.floor(1.5*D)),I<(M+=D)&&(D-=M-I),o=f.scrollTop,l=f.clientHeight,t=f.scrollHeight,o=o+D*(n?-1:1),f.scrollTop=o,v&&(v.scrollTop=o),p&&(p.scrollTop=o),(n?o<t-l:0<=o)&&(g=setTimeout(s,10)),ne.dispatchEvent("scroll",{type:renderType,fixed:e,scrollTop:f.scrollTop,scrollLeft:f.scrollLeft,scrollHeight:f.scrollHeight,scrollWidth:f.scrollWidth,bodyHeight:h,bodyWidth:x,isX:r,isY:i},a))}var l=se.elemStore,t=ie.scrollXLoad,o=ie.scrollYLoad,c=w.value,u=b.value,d=T.value,v=u?u.$el:null,p=d?d.$el:null,f=c.$el,u=l["main-body-ySpace"],d=u?u.value:null,c=l["main-body-xSpace"],u=c?c.value:null,h=(o&&d?d:f).clientHeight,x=(t&&u?u:f).clientWidth,l=$===n?Math.max(0,I-M):0;$=n,I=Math.abs(n?e-l:e+l),M=D=0,clearTimeout(g);s()};(0,_vue.onMounted)(function(){(0,_vue.nextTick)(function(){var e=m.fixedType,l=se.elemStore,e="".concat(e||"main","-body-"),t=S.value;l["".concat(e,"wrapper")]=S,l["".concat(e,"table")]=C,l["".concat(e,"colgroup")]=O,l["".concat(e,"list")]=L,l["".concat(e,"xSpace")]=R,l["".concat(e,"ySpace")]=E,l["".concat(e,"emptyBlock")]=H,t.onscroll=o,t._onscroll=o})}),(0,_vue.onBeforeUnmount)(function(){var e=S.value;clearTimeout(g),e._onscroll=null,e.onscroll=null}),(0,_vue.onUnmounted)(function(){var e=m.fixedType,l=se.elemStore,e="".concat(e||"main","-body-");l["".concat(e,"wrapper")]=null,l["".concat(e,"table")]=null,l["".concat(e,"colgroup")]=null,l["".concat(e,"list")]=null,l["".concat(e,"xSpace")]=null,l["".concat(e,"ySpace")]=null,l["".concat(e,"emptyBlock")]=null});return function(){var e=m.fixedColumn,l=m.fixedType,t=m.tableColumn,o=re.keyboardConfig,a=re.showOverflow,n=re.spanMethod,r=re.mouseConfig,i=ie.tableData,s=ie.mergeList,c=ie.scrollYLoad,u=ie.isAllOverflow,d=se.visibleColumn,v=q.slots,p=ue.value,f=W.value,h=N.value,x=Y.value;return l&&(t=!(c||a&&u)||s.length||n||o&&h.isMerge?d:e),u=v.empty?ne.callSlot(v.empty,{$table:ne}):(a=(c=f.name?_vXETable.VXETable.renderer.get(f.name):null)?c.renderEmpty:null)?(0,_vn.getSlotVNs)(a(f,{$table:ne})):re.emptyText||_conf.default.i18n("vxe.table.emptyText"),(0,_vue.h)("div",__assign({ref:S,class:["vxe-table--body-wrapper",l?"fixed-".concat(l,"--wrapper"):"body--wrapper"],xid:y},"wheel"===p.mode?{onWheel:k}:{}),[l?(0,_vue.createCommentVNode)():(0,_vue.h)("div",{ref:R,class:"vxe-body--x-space"}),(0,_vue.h)("div",{ref:E,class:"vxe-body--y-space"}),(0,_vue.h)("table",{ref:C,class:"vxe-table--body",xid:y,cellspacing:0,cellpadding:0,border:0},[(0,_vue.h)("colgroup",{ref:O},t.map(function(e,l){return(0,_vue.h)("col",{name:e.id,key:l})})),(0,_vue.h)("tbody",{ref:L},B(l,i,t))]),(0,_vue.h)("div",{class:"vxe-table--checkbox-range"}),r&&x.area?(0,_vue.h)("div",{class:"vxe-table--cell-area"},[(0,_vue.h)("span",{class:"vxe-table--cell-main-area"},x.extension?[(0,_vue.h)("span",{class:"vxe-table--cell-main-area-btn",onMousedown:function(e){ne.triggerCellExtendMousedownEvent(e,{$table:ne,fixed:l,type:renderType})}})]:[]),(0,_vue.h)("span",{class:"vxe-table--cell-copy-area"}),(0,_vue.h)("span",{class:"vxe-table--cell-extend-area"}),(0,_vue.h)("span",{class:"vxe-table--cell-multi-area"}),(0,_vue.h)("span",{class:"vxe-table--cell-active-area"})]):null,l?null:(0,_vue.h)("div",{class:"vxe-table--empty-block",ref:H},[(0,_vue.h)("div",{class:"vxe-table--empty-content"},u)])])}}});exports.default=_default;