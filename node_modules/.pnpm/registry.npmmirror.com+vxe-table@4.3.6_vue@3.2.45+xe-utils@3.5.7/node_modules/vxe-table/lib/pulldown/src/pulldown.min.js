"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _vue=require("vue"),_xeUtils=_interopRequireDefault(require("xe-utils")),_conf=_interopRequireDefault(require("../../v-x-e-table/src/conf")),_size=require("../../hooks/size"),_dom=require("../../tools/dom"),_utils=require("../../tools/utils"),_event=require("../../tools/event");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var _default=(0,_vue.defineComponent)({name:"VxePulldown",props:{modelValue:Boolean,disabled:Boolean,placement:String,size:{type:String,default:function(){return _conf.default.size}},destroyOnClose:Boolean,transfer:Boolean},emits:["update:modelValue","hide-panel"],setup:function(c,e){function t(){return p.inited||(p.inited=!0),new Promise(function(e){c.disabled?(0,_vue.nextTick)(function(){e()}):(clearTimeout(a),p.isActivated=!0,p.animatVisible=!0,setTimeout(function(){p.visiblePanel=!0,u("update:modelValue",!0),h(),setTimeout(function(){e(h())},40)},10),r())})}function o(){return p.visiblePanel=!1,u("update:modelValue",!1),new Promise(function(e){p.animatVisible?a=window.setTimeout(function(){(p.animatVisible=!1,_vue.nextTick)(function(){e()})},350):(0,_vue.nextTick)(function(){e()})})}function n(e){var t=c.disabled,n=p.visiblePanel,i=m.value;t||n&&((0,_dom.getEventTargetNode)(e,i).flag?h():(o(),g.dispatchEvent("hide-panel",{},e)))}function i(e){var t=c.disabled,n=p.visiblePanel,i=_.value,l=m.value;t||(p.isActivated=(0,_dom.getEventTargetNode)(e,i).flag||(0,_dom.getEventTargetNode)(e,l).flag,n&&!p.isActivated&&(o(),g.dispatchEvent("hide-panel",{},e)))}function l(e){p.visiblePanel&&(p.isActivated=!1,o(),g.dispatchEvent("hide-panel",{},e))}var a,v=e.slots,u=e.emit,s=_xeUtils.default.uniqueId(),f=(0,_size.useSize)(c),p=(0,_vue.reactive)({inited:!1,panelIndex:0,panelStyle:null,panelPlacement:null,visiblePanel:!1,animatVisible:!1,isActivated:!1}),_=(0,_vue.ref)(),b=(0,_vue.ref)(),m=(0,_vue.ref)(),d={refElem:_},x={xID:s,props:c,context:e,reactData:p,getRefMaps:function(){return d}},r=function(){p.panelIndex<(0,_utils.getLastZIndex)()&&(p.panelIndex=(0,_utils.nextZIndex)())},h=function(){return(0,_vue.nextTick)().then(function(){var e,t,n,i,l,o,a,u,s,d=c.transfer,r=c.placement,v=p.panelIndex;return p.visiblePanel&&(a=b.value,i=m.value)&&a&&(e=a.offsetHeight,t=a.offsetWidth,n=i.offsetHeight,i=i.offsetWidth,v={zIndex:v},l=(a=(0,_dom.getAbsolutePos)(a)).boundingTop,s=a.boundingLeft,o=a.visibleHeight,a=a.visibleWidth,u="bottom",d?(d=l+e,"top"===r?(u="top",d=l-n):r||(o<d+n+5&&(u="top",d=l-n),d<5&&(u="bottom",d=l+e)),a<(s=s)+i+5&&(s-=s+i+5-a),s<5&&(s=5),Object.assign(v,{left:"".concat(s,"px"),top:"".concat(d,"px"),minWidth:"".concat(t,"px")})):"top"===r?(u="top",v.bottom="".concat(e,"px")):r||o<l+e+n&&5<l-e-n&&(u="top",v.bottom="".concat(e,"px")),p.panelStyle=v,p.panelPlacement=u),(0,_vue.nextTick)()})},g={dispatchEvent:function(e,t,n){u(e,Object.assign({$pulldown:x,$event:n},t))},isPanelVisible:function(){return p.visiblePanel},togglePanel:function(){return(p.visiblePanel?o:t)()},showPanel:t,hidePanel:o};Object.assign(x,g),(0,_vue.watch)(function(){return c.modelValue},function(e){(e?t:o)()}),(0,_vue.nextTick)(function(){_event.GlobalEvent.on(x,"mousewheel",n),_event.GlobalEvent.on(x,"mousedown",i),_event.GlobalEvent.on(x,"blur",l)}),(0,_vue.onUnmounted)(function(){_event.GlobalEvent.off(x,"mousewheel"),_event.GlobalEvent.off(x,"mousedown"),_event.GlobalEvent.off(x,"blur")});return x.renderVN=function(){var e,t=c.destroyOnClose,n=c.transfer,i=c.disabled,l=p.inited,o=p.isActivated,a=p.animatVisible,u=p.visiblePanel,s=p.panelStyle,d=p.panelPlacement,r=f.value;return(0,_vue.h)("div",{ref:_,class:["vxe-pulldown",((e={})["size--".concat(r)]=r,e["is--visivle"]=u,e["is--disabled"]=i,e["is--active"]=o,e)]},[(0,_vue.h)("div",{ref:b,class:"vxe-pulldown--content"},v.default?v.default({$pulldown:x}):[]),(0,_vue.h)(_vue.Teleport,{to:"body",disabled:!n||!l},[(0,_vue.h)("div",{ref:m,class:["vxe-table--ignore-clear vxe-pulldown--panel",((i={})["size--".concat(r)]=r,i["is--transfer"]=n,i["animat--leave"]=a,i["animat--enter"]=u,i)],placement:d,style:s},v.dropdown?[(0,_vue.h)("div",{class:"vxe-pulldown--wrapper"},!l||t&&!u&&!a?[]:v.dropdown({$pulldown:x}))]:[])])])},x},render:function(){return this.renderVN()}});exports.default=_default;