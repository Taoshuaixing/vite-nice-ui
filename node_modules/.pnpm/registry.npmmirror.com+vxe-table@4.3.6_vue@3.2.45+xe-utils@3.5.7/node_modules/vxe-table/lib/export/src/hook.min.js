"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var htmlCellElem,_vue=require("vue"),_xeUtils=_interopRequireDefault(require("xe-utils")),_conf=_interopRequireDefault(require("../../v-x-e-table/src/conf")),_vXETable=require("../../v-x-e-table"),_util=require("../../table/src/util"),_utils=require("../../tools/utils"),_log=require("../../tools/log"),_util2=require("./util");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var csvBOM="\ufeff",enterSymbol="\r\n";function defaultFilterExportColumn(e){return e.property||-1<["seq","checkbox","radio"].indexOf(e.type)}var getConvertColumns=function(e){var t=[];return e.forEach(function(e){e.childNodes&&e.childNodes.length?(t.push(e),t.push.apply(t,getConvertColumns(e.childNodes))):t.push(e)}),t},convertToRows=function(e){for(var n=1,r=function(t,e){var o;e&&(t._level=e._level+1,n<t._level)&&(n=t._level),t.childNodes&&t.childNodes.length?(o=0,t.childNodes.forEach(function(e){r(e,t),o+=e._colSpan}),t._colSpan=o):t._colSpan=1},t=(e.forEach(function(e){e._level=1,r(e)}),[]),o=0;o<n;o++)t.push([]);return getConvertColumns(e).forEach(function(e){e.childNodes&&e.childNodes.length?e._rowSpan=1:e._rowSpan=n-e._level+1,t[e._level-1].push(e)}),t};function toTableBorder(e){return!0===e?"full":e||"default"}function getBooleanValue(e){return"TRUE"===e||"true"===e||!0===e}function getHeaderTitle(e,t){return(e.original?t.property:t.getTitle())||""}function getFooterData(e,t){var o=e.footerFilterMethod;return o?t.filter(function(e,t){return o({items:e,$rowIndex:t})}):t}function getCsvCellTypeLabel(e,t){if(t){if("seq"===e.type)return"\t".concat(t);switch(e.cellType){case"string":if(isNaN(t))break;return"\t".concat(t);case"number":break;default:if(12<=t.length&&!isNaN(t))return"\t".concat(t)}}return t}function toTxtCellLabel(e){return/[",\s\n]/.test(e)?'"'.concat(e.replace(/"/g,'""'),'"'):e}function getElementsByTagName(e,t){return e.getElementsByTagName(t)}function getTxtCellKey(e){return"#".concat(e,"@").concat(_xeUtils.default.uniqueId())}function replaceTxtCell(e,t){return e.replace(/#\d+@\d+/g,function(e){return _xeUtils.default.hasOwnProp(t,e)?t[e]:e})}function getTxtCellValue(e,t){return replaceTxtCell(e,t).replace(/^"+$/g,function(e){return'"'.repeat(Math.ceil(e.length/2))})}function parseCsvAndTxt(e,t,n){var r,a,t=t.split(enterSymbol),l=[],c=[];return t.length&&(r={},a=Date.now(),t.forEach(function(e){var o;e&&(o={},e=(e=e.replace(/("")|(\n)/g,function(e,t){var o=getTxtCellKey(a);return r[o]=t?'"':"\n",o}).replace(/"(.*?)"/g,function(e,t){var o=getTxtCellKey(a);return r[o]=replaceTxtCell(t,r),o})).split(n),c.length?(e.forEach(function(e,t){t<c.length&&(o[c[t]]=getTxtCellValue(e.trim(),r))}),l.push(o)):c=e.map(function(e){return getTxtCellValue(e.trim(),r)}))})),{fields:c,rows:l}}function parseCsv(e,t){return parseCsvAndTxt(e,t,",")}function parseTxt(e,t){return parseCsvAndTxt(e,t,"\t")}function parseHTML(e,t){var o,t=getElementsByTagName((new DOMParser).parseFromString(t,"text/html"),"body"),n=[],r=[];return t.length&&(t=getElementsByTagName(t[0],"table")).length&&(o=getElementsByTagName(t[0],"thead")).length&&(_xeUtils.default.arrayEach(getElementsByTagName(o[0],"tr"),function(e){_xeUtils.default.arrayEach(getElementsByTagName(e,"th"),function(e){r.push(e.textContent)})}),(o=getElementsByTagName(t[0],"tbody")).length)&&_xeUtils.default.arrayEach(getElementsByTagName(o[0],"tr"),function(e){var o={};_xeUtils.default.arrayEach(getElementsByTagName(e,"td"),function(e,t){r[t]&&(o[r[t]]=e.textContent||"")}),n.push(o)}),{fields:r,rows:n}}function parseXML(e,t){var t=getElementsByTagName((new DOMParser).parseFromString(t,"application/xml"),"Worksheet"),n=[],r=[];return t.length&&(t=getElementsByTagName(t[0],"Table")).length&&(t=getElementsByTagName(t[0],"Row")).length&&(_xeUtils.default.arrayEach(getElementsByTagName(t[0],"Cell"),function(e){r.push(e.textContent)}),_xeUtils.default.arrayEach(t,function(e,t){var o;t&&(o={},t=getElementsByTagName(e,"Cell"),_xeUtils.default.arrayEach(t,function(e,t){r[t]&&(o[r[t]]=e.textContent)}),n.push(o))})),{fields:r,rows:n}}function clearColumnConvert(e){_xeUtils.default.eachTree(e,function(e){delete e._level,delete e._colSpan,delete e._rowSpan,delete e._children,delete e.childNodes},{children:"children"})}function checkImportData(e,t){var o=[];return e.forEach(function(e){e=e.property;e&&o.push(e)}),t.some(function(e){return-1<o.indexOf(e)})}var tableExportMethodKeys=["exportData","importByFile","importData","saveFile","readFile","print","openImport","openExport","openPrint"],tableExportHook={setupTable:function(w){function v(e,t,o,n){var r=a.value.seqMethod||o.seqMethod;return r?r({row:e,rowIndex:w.getRowIndex(e),$rowIndex:t,column:o,columnIndex:w.getColumnIndex(o),$columnIndex:n}):w.getRowSeq(e)}function g(e){return _xeUtils.default.isBoolean(e)?e?"TRUE":"FALSE":e}function C(e,t,o){var n=o.editRender||o.cellRender,r=o.footerExportMethod,n=(!r&&n&&n.name&&(n=_vXETable.VXETable.renderer.get(n.name))&&(r=n.footerExportMethod),w.getVTColumnIndex(o));return r?r({$table:w,items:t,itemIndex:n,_columnIndex:n,column:o,options:e}):_xeUtils.default.toValueString(t[n])}function k(e,t,o){return e=e[t],t=_xeUtils.default.isUndefined(e)||_xeUtils.default.isNull(e)?o:e,o="title"===t||(!0===t||"tooltip"===t)||"ellipsis"===t,e=j.scrollXLoad,t=j.scrollYLoad,o=e||t?o||!0:o}function b(l){var c=l.remote,i=l.columns,s=l.colgroups,d=l.exportMethod,t=l.afterExportMethod;return new Promise(function(e){var a,t,o,n,r;c?(t={options:l,$table:w,$grid:T},e(d?d(t):t)):(o=(t=l).columns,n=t.dataFilterMethod,r=t.data,n&&(r=r.filter(function(e,t){return n({row:e,$rowIndex:t})})),a=u(t,o,r),e(w.preventEvent(null,"event.export",{options:l,columns:i,colgroups:s,datas:a},function(){var e,t=l,o=function(e,t,o){if(t.length)switch(e.type){case"csv":return p(e,t,o);case"txt":return f(e,t,o);case"html":return h(e,t,o);case"xml":return m(e,t,o)}return""}(l,i,a),n=t.filename,r=t.type;if(!t.download)return e=(0,_util2.getExportBlobByContent)(o,t),Promise.resolve({type:r,content:o,blob:e});(0,_util2.saveLocalFile)({filename:n,type:r,content:o}).then(function(){!1!==t.message&&("development"!==process.env.NODE_ENV||_vXETable.VXETable.modal||(0,_log.errLog)("vxe.error.reqModule",["Modal"]),_vXETable.VXETable.modal.message({content:_conf.default.i18n("vxe.table.expSuccess"),status:"success"}))})})))}).then(function(e){return clearColumnConvert(i),l.print||t&&t({status:!0,options:l,$table:w,$grid:T}),Object.assign({status:!0},e)}).catch(function(){clearColumnConvert(i),l.print||t&&t({status:!1,options:l,$table:w,$grid:T});return Promise.reject({status:!1})})}function r(a,l){var c=l.importMethod,t=l.afterImportMethod,e=(0,_utils.parseFile)(a),s=e.type,d=e.filename;return c||_xeUtils.default.includes(_vXETable.VXETable.config.importTypes,s)?new Promise(function(t,o){function e(e){t(e),_._importResolve=null,_._importReject=null}function n(e){o(e),_._importResolve=null,_._importReject=null}var i,r;_._importResolve=e,_._importReject=n,window.FileReader?(i=Object.assign({mode:"insert"},l,{type:s,filename:d})).remote?c?Promise.resolve(c({file:a,options:i,$table:w})).then(function(){e({status:!0})}).catch(function(){e({status:!0})}):e({status:!0}):(r=_.tableFullColumn,w.preventEvent(null,"event.import",{file:a,options:i,columns:r},function(){var e=new FileReader;e.onerror=function(){(0,_log.errLog)("vxe.error.notType",[s]),n({status:!1})},e.onload=function(e){var t=e.target.result,o=i,n=_.tableFullColumn,r=_._importResolve,e=_._importReject,a={fields:[],rows:[]};switch(o.type){case"csv":a=parseCsv(n,t);break;case"txt":a=parseTxt(n,t);break;case"html":a=parseHTML(n,t);break;case"xml":a=parseXML(n,t)}var l=a.fields,c=a.rows;checkImportData(n,l)?w.createData(c).then(function(e){e="insert"===o.mode?w.insert(e):w.reloadData(e);return!1!==o.message&&("development"!==process.env.NODE_ENV||_vXETable.VXETable.modal||(0,_log.errLog)("vxe.error.reqModule",["Modal"]),_vXETable.VXETable.modal.message({content:_conf.default.i18n("vxe.table.impSuccess",[c.length]),status:"success"})),e.then(function(){r&&r({status:!0})})}):!1!==o.message&&("development"!==process.env.NODE_ENV||_vXETable.VXETable.modal||(0,_log.errLog)("vxe.error.reqModule",["Modal"]),_vXETable.VXETable.modal.message({content:_conf.default.i18n("vxe.error.impFields"),status:"error"}),e)&&e({status:!1})},e.readAsText(a,i.encoding||"UTF-8")})):("development"===process.env.NODE_ENV&&(0,_log.errLog)("vxe.error.notExp"),e({status:!0}))}).then(function(){t&&t({status:!0,options:l,$table:w})}).catch(function(e){return t&&t({status:!1,options:l,$table:w}),Promise.reject(e)}):(!1!==l.message&&("development"!==process.env.NODE_ENV||_vXETable.VXETable.modal||(0,_log.errLog)("vxe.error.reqModule",["Modal"]),_vXETable.VXETable.modal.message({content:_conf.default.i18n("vxe.error.notType",[s]),status:"error"})),Promise.reject({status:!1}))}function o(e,t){var o=N.treeConfig,n=N.showHeader,r=N.showFooter,a=j.initStore,l=j.mergeList,c=j.isGroup,i=j.footerTableData,s=j.exportStore,d=j.exportParams,u=_.collectColumn,p=x.value,f=w.getCheckboxRecords(),i=!!i.length,l=!o&&l.length,r=(n=Object.assign({message:!0,isHeader:n,isFooter:r},e)).types||_vXETable.VXETable.config.exportTypes,e=n.modes,h=p.checkMethod,p=u.slice(0),m=n.columns,u=r.map(function(e){return{value:e,label:"vxe.export.types.".concat(e)}}),v=e.map(function(e){return{value:e,label:"vxe.export.modes.".concat(e)}});_xeUtils.default.eachTree(p,function(n,e,t,o,r){(n.children&&n.children.length||defaultFilterExportColumn(n))&&(n.checked=m?m.some(function(e){var t,o;return(0,_util.isColumnInfo)(e)?n===e:_xeUtils.default.isString(e)?n.field===e:(t=e.id||e.colId,o=e.type,e=e.property||e.field,t?n.id===t:e&&o?n.property===e&&n.type===o:e?n.property===e:!!o&&n.type===o)}):n.visible,n.halfChecked=!1,n.disabled=r&&r.disabled||!!h&&!h({column:n}))}),Object.assign(s,{columns:p,typeList:u,modeList:v,hasFooter:i,hasMerge:l,hasTree:o,isPrint:t,hasColgroup:c,visible:!0}),a.export||Object.assign(d,{mode:f.length?"selected":"current"},n),-1===e.indexOf(d.mode)&&(d.mode=e[0]),-1===r.indexOf(d.type)&&(d.type=r[0]),a.export=!0,(0,_vue.nextTick)()}var N=w.props,j=w.reactData,_=w.internalData,e=w.getComputeMaps(),D=e.computeTreeOpts,n=e.computePrintOpts,y=e.computeExportOpts,c=e.computeImportOpts,x=e.computeCustomOpts,a=e.computeSeqOpts,l=e.computeRadioOpts,i=e.computeCheckboxOpts,T=(0,_vue.inject)("$xegrid",null),u=function(d,r,e){var a,u,p=d.isAllExpand,f=d.mode,t=N.treeConfig,h=l.value,m=i.value,o=D.value;return htmlCellElem=htmlCellElem||document.createElement("div"),t?(a=[],u=new Map,_xeUtils.default.eachTree(e,function(e,l,t,c,o,n){var i,s=e._row||e,e=o&&o._row?o._row:o;(p||!e||u.has(e)&&w.isTreeExpandByRow(e))&&(o=s,e=D.value,o=o[e.children]&&o[e.children].length,i={_row:s,_level:n.length-1,_hasChild:o,_expand:o&&w.isTreeExpandByRow(s)},r.forEach(function(e,t){var o,n="",r=e.editRender||e.cellRender,a=e.exportMethod;if(a=!a&&r&&r.name&&(r=_vXETable.VXETable.renderer.get(r.name))?r.exportMethod:a)n=a({$table:w,row:s,column:e,options:d});else switch(e.type){case"seq":n="all"===f?c.map(function(e,t){return t%2==0?Number(e)+1:"."}).join(""):v(s,l,e,t);break;case"checkbox":n=g(w.isCheckedByCheckboxRow(s)),i._checkboxLabel=m.labelField?_xeUtils.default.get(s,m.labelField):"",i._checkboxDisabled=m.checkMethod&&!m.checkMethod({row:s});break;case"radio":n=g(w.isCheckedByRadioRow(s)),i._radioLabel=h.labelField?_xeUtils.default.get(s,h.labelField):"",i._radioDisabled=h.checkMethod&&!h.checkMethod({row:s});break;default:d.original?n=(0,_util.getCellValue)(s,e):(n=w.getCellLabel(s,e),"html"===e.type?(htmlCellElem.innerHTML=n,n=htmlCellElem.innerText.trim()):(o=w.getCell(s,e))&&(n=o.innerText.trim()))}i[e.id]=_xeUtils.default.toValueString(n)}),u.set(s,1),a.push(Object.assign(i,s)))},o),a):e.map(function(l,c){var i={_row:l};return r.forEach(function(e,t){var o,n="",r=e.editRender||e.cellRender,a=e.exportMethod;if(a=!a&&r&&r.name&&(r=_vXETable.VXETable.renderer.get(r.name))?r.exportMethod:a)n=a({$table:w,row:l,column:e,options:d});else switch(e.type){case"seq":n="all"===f?c+1:v(l,c,e,t);break;case"checkbox":n=g(w.isCheckedByCheckboxRow(l)),i._checkboxLabel=m.labelField?_xeUtils.default.get(l,m.labelField):"",i._checkboxDisabled=m.checkMethod&&!m.checkMethod({row:l});break;case"radio":n=g(w.isCheckedByRadioRow(l)),i._radioLabel=h.labelField?_xeUtils.default.get(l,h.labelField):"",i._radioDisabled=h.checkMethod&&!h.checkMethod({row:l});break;default:d.original?n=(0,_util.getCellValue)(l,e):(n=w.getCellLabel(l,e),"html"===e.type?(htmlCellElem.innerHTML=n,n=htmlCellElem.innerText.trim()):(o=w.getCell(l,e))&&(n=o.innerText.trim()))}i[e.id]=_xeUtils.default.toValueString(n)}),i})},p=function(o,e,t){var n=csvBOM;return o.isHeader&&(n+=e.map(function(e){return toTxtCellLabel(getHeaderTitle(o,e))}).join(",")+enterSymbol),t.forEach(function(t){n+=e.map(function(e){return toTxtCellLabel(getCsvCellTypeLabel(e,t[e.id]))}).join(",")+enterSymbol}),o.isFooter&&(t=j.footerTableData,getFooterData(o,t).forEach(function(t){n+=e.map(function(e){return toTxtCellLabel(C(o,t,e))}).join(",")+enterSymbol})),n},f=function(o,e,t){var n="";return o.isHeader&&(n+=e.map(function(e){return toTxtCellLabel(getHeaderTitle(o,e))}).join("\t")+enterSymbol),t.forEach(function(t){n+=e.map(function(e){return toTxtCellLabel(t[e.id])}).join("\t")+enterSymbol}),o.isFooter&&(t=j.footerTableData,getFooterData(o,t).forEach(function(t){n+=e.map(function(e){return toTxtCellLabel(C(o,t,e))}).join(",")+enterSymbol})),n},h=function(c,e,t){var s=N.id,o=N.border,n=N.treeConfig,i=N.headerAlign,d=N.align,a=N.footerAlign,u=N.showOverflow,p=N.showHeaderOverflow,f=j.isAllSelected,r=j.isIndeterminate,h=j.mergeList,l=D.value,m=c.print,v=c.isHeader,g=c.isFooter,x=c.isColgroup,b=c.isMerge,_=c.colgroups,y=c.original,T="check-all",o=["vxe-table","border--".concat(toTableBorder(o)),m?"is--print":"",v?"is--header":""].filter(function(e){return e}),E=['<table class="'.concat(o.join(" "),'" border="0" cellspacing="0" cellpadding="0">'),"<colgroup>".concat(e.map(function(e){return'<col style="width:'.concat(e.renderWidth,'px">')}).join(""),"</colgroup>")],x=(v&&(E.push("<thead>"),x&&!y?_.forEach(function(e){E.push("<tr>".concat(e.map(function(t){var e=t.headerAlign||t.align||i||d,o=k(t,"showHeaderOverflow",p)?["col--ellipsis"]:[],n=getHeaderTitle(c,t),r=0,a=0,l=(_xeUtils.default.eachTree([t],function(e){e.childNodes&&t.childNodes.length||a++,r+=e.renderWidth},{children:"childNodes"}),r-a);return e&&o.push("col--".concat(e)),"checkbox"===t.type?'<th class="'.concat(o.join(" "),'" colspan="').concat(t._colSpan,'" rowspan="').concat(t._rowSpan,'"><div ').concat(m?"":'style="width: '.concat(l,'px"'),'><input type="checkbox" class="').concat(T,'" ').concat(f?"checked":"","><span>").concat(n,"</span></div></th>"):'<th class="'.concat(o.join(" "),'" colspan="').concat(t._colSpan,'" rowspan="').concat(t._rowSpan,'" title="').concat(n,'"><div ').concat(m?"":'style="width: '.concat(l,'px"'),"><span>").concat((0,_utils.formatText)(n,!0),"</span></div></th>")}).join(""),"</tr>"))}):E.push("<tr>".concat(e.map(function(e){var t=e.headerAlign||e.align||i||d,o=k(e,"showHeaderOverflow",p)?["col--ellipsis"]:[],n=getHeaderTitle(c,e);return t&&o.push("col--".concat(t)),"checkbox"===e.type?'<th class="'.concat(o.join(" "),'"><div ').concat(m?"":'style="width: '.concat(e.renderWidth,'px"'),'><input type="checkbox" class="').concat(T,'" ').concat(f?"checked":"","><span>").concat(n,"</span></div></th>"):'<th class="'.concat(o.join(" "),'" title="').concat(n,'"><div ').concat(m?"":'style="width: '.concat(e.renderWidth,'px"'),"><span>").concat((0,_utils.formatText)(n,!0),"</span></div></th>")}).join(""),"</tr>")),E.push("</thead>")),t.length&&(E.push("<tbody>"),n?t.forEach(function(r){E.push("<tr>"+e.map(function(e){var t=e.align||d,o=k(e,"showOverflow",u)?["col--ellipsis"]:[],n=r[e.id];return t&&o.push("col--".concat(t)),e.treeNode?(t="",r._hasChild&&(t='<i class="'.concat(r._expand?"vxe-table--tree-fold-icon":"vxe-table--tree-unfold-icon",'"></i>')),o.push("vxe-table--tree-node"),"radio"===e.type?'<td class="'.concat(o.join(" "),'" title="').concat(n,'"><div ').concat(m?"":'style="width: '.concat(e.renderWidth,'px"'),'><div class="vxe-table--tree-node-wrapper" style="padding-left: ').concat(r._level*l.indent,'px"><div class="vxe-table--tree-icon-wrapper">').concat(t,'</div><div class="vxe-table--tree-cell"><input type="radio" name="radio_').concat(s,'" ').concat(r._radioDisabled?"disabled ":"").concat(getBooleanValue(n)?"checked":"","><span>").concat(r._radioLabel,"</span></div></div></div></td>"):"checkbox"===e.type?'<td class="'.concat(o.join(" "),'" title="').concat(n,'"><div ').concat(m?"":'style="width: '.concat(e.renderWidth,'px"'),'><div class="vxe-table--tree-node-wrapper" style="padding-left: ').concat(r._level*l.indent,'px"><div class="vxe-table--tree-icon-wrapper">').concat(t,'</div><div class="vxe-table--tree-cell"><input type="checkbox" ').concat(r._checkboxDisabled?"disabled ":"").concat(getBooleanValue(n)?"checked":"","><span>").concat(r._checkboxLabel,"</span></div></div></div></td>"):'<td class="'.concat(o.join(" "),'" title="').concat(n,'"><div ').concat(m?"":'style="width: '.concat(e.renderWidth,'px"'),'><div class="vxe-table--tree-node-wrapper" style="padding-left: ').concat(r._level*l.indent,'px"><div class="vxe-table--tree-icon-wrapper">').concat(t,'</div><div class="vxe-table--tree-cell">').concat(n,"</div></div></div></td>")):"radio"===e.type?'<td class="'.concat(o.join(" "),'"><div ').concat(m?"":'style="width: '.concat(e.renderWidth,'px"'),'><input type="radio" name="radio_').concat(s,'" ').concat(r._radioDisabled?"disabled ":"").concat(getBooleanValue(n)?"checked":"","><span>").concat(r._radioLabel,"</span></div></td>"):"checkbox"===e.type?'<td class="'.concat(o.join(" "),'"><div ').concat(m?"":'style="width: '.concat(e.renderWidth,'px"'),'><input type="checkbox" ').concat(r._checkboxDisabled?"disabled ":"").concat(getBooleanValue(n)?"checked":"","><span>").concat(r._checkboxLabel,"</span></div></td>"):'<td class="'.concat(o.join(" "),'" title="').concat(n,'"><div ').concat(m?"":'style="width: '.concat(e.renderWidth,'px"'),">").concat((0,_utils.formatText)(n,!0),"</div></td>")}).join("")+"</tr>")}):t.forEach(function(i){E.push("<tr>"+e.map(function(e){var t=e.align||d,o=k(e,"showOverflow",u)?["col--ellipsis"]:[],n=i[e.id],r=1,a=1;if(b&&h.length){var l=w.getVTRowIndex(i._row),c=w.getVTColumnIndex(e),l=(0,_util.mergeBodyMethod)(h,l,c);if(l){c=l.rowspan,l=l.colspan;if(!c||!l)return"";1<c&&(r=c),1<l&&(a=l)}}return t&&o.push("col--".concat(t)),"radio"===e.type?'<td class="'.concat(o.join(" "),'" rowspan="').concat(r,'" colspan="').concat(a,'"><div ').concat(m?"":'style="width: '.concat(e.renderWidth,'px"'),'><input type="radio" name="radio_').concat(s,'" ').concat(i._radioDisabled?"disabled ":"").concat(getBooleanValue(n)?"checked":"","><span>").concat(i._radioLabel,"</span></div></td>"):"checkbox"===e.type?'<td class="'.concat(o.join(" "),'" rowspan="').concat(r,'" colspan="').concat(a,'"><div ').concat(m?"":'style="width: '.concat(e.renderWidth,'px"'),'><input type="checkbox" ').concat(i._checkboxDisabled?"disabled ":"").concat(getBooleanValue(n)?"checked":"","><span>").concat(i._checkboxLabel,"</span></div></td>"):'<td class="'.concat(o.join(" "),'" rowspan="').concat(r,'" colspan="').concat(a,'" title="').concat(n,'"><div ').concat(m?"":'style="width: '.concat(e.renderWidth,'px"'),">").concat((0,_utils.formatText)(n,!0),"</div></td>")}).join("")+"</tr>")}),E.push("</tbody>")),g&&(o=j.footerTableData,(v=getFooterData(c,o)).length)&&(E.push("<tfoot>"),v.forEach(function(r){E.push("<tr>".concat(e.map(function(e){var t=e.footerAlign||e.align||a||d,o=k(e,"showOverflow",u)?["col--ellipsis"]:[],n=C(c,r,e);return t&&o.push("col--".concat(t)),'<td class="'.concat(o.join(" "),'" title="').concat(n,'"><div ').concat(m?"":'style="width: '.concat(e.renderWidth,'px"'),">").concat((0,_utils.formatText)(n,!0),"</div></td>")}).join(""),"</tr>"))}),E.push("</tfoot>")),!f&&r?'<script>(function(){var a=document.querySelector(".'.concat(T,'");if(a){a.indeterminate=true}})()<\/script>'):"");return E.push("</table>",x),m?E.join(""):(0,_util2.createHtmlPage)(c,E.join(""))},m=function(o,e,t){var n=['<?xml version="1.0"?>','<?mso-application progid="Excel.Sheet"?>','<Workbook xmlns="urn:schemas-microsoft-com:office:spreadsheet" xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns:ss="urn:schemas-microsoft-com:office:spreadsheet" xmlns:html="http://www.w3.org/TR/REC-html40">','<DocumentProperties xmlns="urn:schemas-microsoft-com:office:office">',"<Version>16.00</Version>","</DocumentProperties>",'<ExcelWorkbook xmlns="urn:schemas-microsoft-com:office:excel">',"<WindowHeight>7920</WindowHeight>","<WindowWidth>21570</WindowWidth>","<WindowTopX>32767</WindowTopX>","<WindowTopY>32767</WindowTopY>","<ProtectStructure>False</ProtectStructure>","<ProtectWindows>False</ProtectWindows>","</ExcelWorkbook>",'<Worksheet ss:Name="'.concat(o.sheetName,'">'),"<Table>",e.map(function(e){return'<Column ss:Width="'.concat(e.renderWidth,'"/>')}).join("")].join("");return o.isHeader&&(n+="<Row>".concat(e.map(function(e){return'<Cell><Data ss:Type="String">'.concat(getHeaderTitle(o,e),"</Data></Cell>")}).join(""),"</Row>")),t.forEach(function(t){n+="<Row>"+e.map(function(e){return'<Cell><Data ss:Type="String">'.concat(t[e.id],"</Data></Cell>")}).join("")+"</Row>"}),o.isFooter&&(t=j.footerTableData,getFooterData(o,t).forEach(function(t){n+="<Row>".concat(e.map(function(e){return'<Cell><Data ss:Type="String">'.concat(C(o,t,e),"</Data></Cell>")}).join(""),"</Row>")})),"".concat(n,"</Table></Worksheet></Workbook>")},s={exportData:function(e){var t=N.treeConfig,o=j.isGroup,n=j.tableGroupColumn,a=_.tableFullColumn,r=_.afterFullData,l=y.value,c=D.value,i=Object.assign({isHeader:!0,isFooter:!0,isColgroup:!0,download:!0,type:"csv",mode:"current"},l,{print:!1},e),l=i.type,e=i.mode,s=i.columns,d=i.original,u=i.beforeExportMethod,p=[],s=s&&s.length?s:null,f=i.columnFilterMethod,h=(s||(f=f||(d?function(e){return e.column.property}:function(e){return defaultFilterExportColumn(e.column)})),p=s?_xeUtils.default.searchTree(_xeUtils.default.mapTree(s,function(e){var t,o,n,r;if(e)return(0,_util.isColumnInfo)(e)?t=e:_xeUtils.default.isString(e)?t=w.getColumnByField(e):(o=e.id||e.colId,n=e.type,r=e.property||e.field,o?t=w.getColumnById(o):r&&n?t=a.find(function(e){return e.property===r&&e.type===n}):r?t=w.getColumnByField(r):n&&(t=a.find(function(e){return e.type===n}))),t||{}},{children:"childNodes",mapChildren:"_children"}),function(e,t){return(0,_util.isColumnInfo)(e)&&(!f||f({column:e,$columnIndex:t}))},{children:"_children",mapChildren:"childNodes",original:!0}):_xeUtils.default.searchTree(o?n:a,function(e,t){return e.visible&&(!f||f({column:e,$columnIndex:t}))},{children:"children",mapChildren:"childNodes",original:!0}),[]);if(_xeUtils.default.eachTree(p,function(e){e.children&&e.children.length||h.push(e)},{children:"childNodes"}),i.columns=h,i.colgroups=convertToRows(p),i.filename||(i.filename=_conf.default.i18n(i.original?"vxe.table.expOriginFilename":"vxe.table.expFilename",[_xeUtils.default.toDateString(Date.now(),"yyyyMMddHHmmss")])),i.sheetName||(i.sheetName=document.title),!i.exportMethod&&!_xeUtils.default.includes(_vXETable.VXETable.config.exportTypes,l))return"development"===process.env.NODE_ENV&&(0,_log.errLog)("vxe.error.notType",[l]),Promise.reject({status:!1});if(i.print||u&&u({options:i,$table:w,$grid:T}),!i.data)if(i.data=r,"selected"===e){var m=w.getCheckboxRecords();-1<["html","pdf"].indexOf(l)&&t?i.data=_xeUtils.default.searchTree(w.getTableData().fullData,function(e){return-1<w.findRowIndexOf(m,e)},Object.assign({},c,{data:"_row"})):i.data=m}else if("all"===e&&("development"!==process.env.NODE_ENV||T||(0,_log.warnLog)("vxe.error.errProp",["all","mode=current,selected"]),T)&&!i.remote){var v,d=T.reactData,s=T.getComputeMaps().computeProxyOpts.value,o=s.beforeQueryAll,g=s.afterQueryAll,n=s.ajax,p=s.props,x=void 0===p?{}:p,u=(void 0===n?{}:n).queryAll;if("development"!==process.env.NODE_ENV||u||(0,_log.warnLog)("vxe.error.notFunc",["proxy-config.ajax.queryAll"]),u)return v={$table:w,$grid:T,sort:d.sortData,filters:d.filterData,form:d.formData,target:u,options:i},Promise.resolve((o||u)(v)).catch(function(e){return e}).then(function(e){return i.data=(x.list?_xeUtils.default.get(e,x.list):e)||[],g&&g(v),b(i)})}return b(i)},importByFile:function(e,t){var t=Object.assign({},t),o=t.beforeImportMethod;return o&&o({options:t,$table:w}),r(e,t)},importData:function(e){var t=c.value,o=Object.assign({types:_vXETable.VXETable.config.importTypes},t,e),t=o.beforeImportMethod,n=o.afterImportMethod;return t&&t({options:o,$table:w}),(0,_util2.readLocalFile)(o).catch(function(e){return n&&n({status:!1,options:o,$table:w}),Promise.reject(e)}).then(function(e){e=e.file;return r(e,o)})},saveFile:function(e){return(0,_util2.saveLocalFile)(e)},readFile:function(e){return(0,_util2.readLocalFile)(e)},print:function(e){var t=n.value,o=Object.assign({original:!1},t,e,{type:"html",download:!1,remote:!1,print:!0});return o.sheetName||(o.sheetName=document.title),new Promise(function(e){o.content?e((0,_util2.handlePrint)(w,o,o.content)):e(s.exportData(o).then(function(e){e=e.content;return(0,_util2.handlePrint)(w,o,e)}))})},openImport:function(e){var t=N.treeConfig,o=N.importConfig,n=j.initStore,r=j.importStore,a=j.importParams,l=c.value,e=Object.assign({mode:"insert",message:!0,types:_vXETable.VXETable.config.importTypes},e,l),l=e.types;!t?(o||(0,_log.errLog)("vxe.error.reqProp",["import-config"]),t=l.map(function(e){return{value:e,label:"vxe.export.types.".concat(e)}}),o=e.modes.map(function(e){return{value:e,label:"vxe.import.modes.".concat(e)}}),Object.assign(r,{file:null,type:"",filename:"",modeList:o,typeList:t,visible:!0}),Object.assign(a,e),n.import=!0):e.message&&_vXETable.VXETable.modal.message({content:_conf.default.i18n("vxe.error.treeNotImp"),status:"error"})},openExport:function(e){var t=y.value;"development"!==process.env.NODE_ENV||N.exportConfig||(0,_log.errLog)("vxe.error.reqProp",["export-config"]),o(Object.assign({},t,e))},openPrint:function(e){var t=n.value;"development"!==process.env.NODE_ENV||N.printConfig||(0,_log.errLog)("vxe.error.reqProp",["print-config"]),o(Object.assign({},t,e),!0)}};return s},setupGrid:function(e){return e.extendTableMethods(tableExportMethodKeys)}},_default=tableExportHook;exports.default=_default;