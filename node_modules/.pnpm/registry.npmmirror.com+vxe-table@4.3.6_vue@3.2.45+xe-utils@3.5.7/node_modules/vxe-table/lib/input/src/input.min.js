"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _vue=require("vue"),_xeUtils=_interopRequireDefault(require("xe-utils")),_conf=_interopRequireDefault(require("../../v-x-e-table/src/conf")),_size=require("../../hooks/size"),_utils=require("../../tools/utils"),_dom=require("../../tools/dom"),_event=require("../../tools/event"),_date=require("./date"),_number=require("./number");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var yearSize=12,monthSize=20,quarterSize=8,_default=(0,_vue.defineComponent)({name:"VxeInput",props:{modelValue:[String,Number,Date],immediate:{type:Boolean,default:!0},name:String,type:{type:String,default:"text"},clearable:{type:Boolean,default:function(){return _conf.default.input.clearable}},readonly:Boolean,disabled:Boolean,placeholder:String,maxlength:[String,Number],autocomplete:{type:String,default:"off"},align:String,form:String,className:String,size:{type:String,default:function(){return _conf.default.input.size||_conf.default.size}},multiple:Boolean,min:{type:[String,Number],default:null},max:{type:[String,Number],default:null},step:[String,Number],exponential:{type:Boolean,default:function(){return _conf.default.input.exponential}},controls:{type:Boolean,default:function(){return _conf.default.input.controls}},digits:{type:[String,Number],default:function(){return _conf.default.input.digits}},startDate:{type:[String,Number,Date],default:function(){return _conf.default.input.startDate}},endDate:{type:[String,Number,Date],default:function(){return _conf.default.input.endDate}},minDate:[String,Number,Date],maxDate:[String,Number,Date],startWeek:Number,startDay:{type:[String,Number],default:function(){return _conf.default.input.startDay}},labelFormat:{type:String,default:function(){return _conf.default.input.labelFormat}},valueFormat:{type:String,default:function(){return _conf.default.input.valueFormat}},editable:{type:Boolean,default:!0},festivalMethod:{type:Function,default:function(){return _conf.default.input.festivalMethod}},disabledMethod:{type:Function,default:function(){return _conf.default.input.disabledMethod}},selectDay:{type:[String,Number],default:function(){return _conf.default.input.selectDay}},prefixIcon:String,suffixIcon:String,placement:String,transfer:{type:Boolean,default:function(){return _conf.default.input.transfer}}},emits:["update:modelValue","input","change","keydown","keyup","wheel","click","focus","blur","clear","search-click","toggle-visible","prev-number","next-number","prefix-click","suffix-click","date-prev","date-today","date-next"],setup:function(W,e){function M(e){var t=e.target.value;tt(t,e)}function R(e){$e.value||s(e)}function O(e){A.isActivated=!0,s(e)}function S(e,t){var a=W.type,n=w.value;k.value&&b(),(n||-1<["text","search","password"].indexOf(a))&&focus(),r.dispatchEvent("clear",{value:t},e)}function y(){var e=k.value,t=A.inputValue;e&&(p(t),A.inputValue=W.multiple?De.value:A.datePanelLabel)}function t(){var e=W.type,t=A.inputValue,a=k.value,n=xe.value;a?y():"float"===e&&t&&t!==(a=(0,_number.toFloatValueFixed)(t,n))&&f(a,{type:"init"})}function z(e){var t=A.inputValue;$e.value||f(t,e),U(),A.visiblePanel||(A.isActivated=!1),r.dispatchEvent("blur",{value:t},e)}function D(e){var t=W.readonly,a=W.disabled,n=A.showPwd;a||t||(A.showPwd=!n),r.dispatchEvent("toggle-visible",{visible:A.showPwd},e)}function H(e){r.dispatchEvent("search-click",{},e)}function L(e,t){var a=W.min,n=W.max,u=W.type,l=A.inputValue,i=ye.value,u="integer"===u?_xeUtils.default.toInteger((0,_number.handleNumber)(l)):_xeUtils.default.toNumber((0,_number.handleNumber)(l)),l=e?_xeUtils.default.add(u,i):_xeUtils.default.subtract(u,i),e=lt(l)?ut(l)?l:n:a;tt(et(e),t)}function G(e){u=window.setTimeout(function(){h(e),G(e)},60)}function B(e){var t,a,n,u,l=W.exponential,i=W.controls;w.value&&(t=e.ctrlKey,a=e.shiftKey,n=e.altKey,u=e.keyCode,t||a||n||!((0,_event.hasEventKey)(e,_event.EVENT_KEYS.SPACEBAR)||(!l||69!==u)&&65<=u&&u<=90||186<=u&&u<=188||191<=u)||e.preventDefault(),i)&&rt(e),s(e)}function j(e){s(e)}function a(){clearTimeout(u)}function Q(e){u=window.setTimeout(function(){x(e),Q(e)},60)}function $(e){var t;a(),0===e.button&&(((t=(0,_dom.hasClass)(e.currentTarget,"is--prev"))?x:h)(e),u=window.setTimeout(function(){(t?Q:G)(e)},500))}function Z(e){var t;w.value&&W.controls&&A.isActivated&&(0<(t=e.deltaY)?h(e):t<0&&x(e),e.preventDefault()),s(e)}function X(){var e="month"===(e=A.datePanelType)||"quarter"===e?"year":"month";A.datePanelType=e}function J(e){ot(),W.multiple||(m(A.currentDate),b()),r.dispatchEvent("date-today",{type:W.type},e)}function Y(e){var t=W.disabledMethod,a=A.datePanelType;return t&&t({type:a,viewType:a,date:e.date,$input:i})}function ee(e){var t=W.type,a=W.multiple,n=A.datePanelType;"month"===t?"year"===n?(A.datePanelType="month",_(e)):(m(e),a||b()):"year"===t?(m(e),a||b()):"quarter"===t?"year"===n?(A.datePanelType="quarter",_(e)):(m(e),a||b()):"month"===n?(A.datePanelType="week"===t?t:"day",_(e)):"year"===n?(A.datePanelType="month",_(e)):(m(e),a||b())}function C(e){Y(e)||ee(e.date)}function q(e){var t;Y(e)||("month"===(t=A.datePanelType)?_t:"quarter"===t?pt:"year"===t?ft:dt)(e.date)}function l(e){A.datetimePanelValue=new Date(A.datetimePanelValue.getTime()),mt(e.currentTarget)}function te(){var e=W.multiple,t=I.value;(c.value||e)&&m(t||A.currentDate),b()}function n(){return(0,_vue.nextTick)().then(function(){var e,t,a,n,u,l,i,r=W.transfer,s=W.placement,o=A.panelIndex,c=N.value,v=V.value;if(c&&v)return e=c.offsetHeight,t=c.offsetWidth,a=v.offsetHeight,v=v.offsetWidth,o={zIndex:o},n=(c=(0,_dom.getAbsolutePos)(c)).boundingTop,i=c.boundingLeft,u=c.visibleHeight,c=c.visibleWidth,l="bottom",r?(r=n+e,"top"===s?(l="top",r=n-a):s||(u<r+a+5&&(l="top",r=n-a),r<5&&(l="bottom",r=n+e)),c<(i=i)+v+5&&(i-=i+v+5-c),i<5&&(i=5),Object.assign(o,{left:"".concat(i,"px"),top:"".concat(r,"px"),minWidth:"".concat(t,"px")})):"top"===s?(l="top",o.bottom="".concat(e,"px")):s||u<n+e+a&&5<n-e-a&&(l="top",o.bottom="".concat(e,"px")),A.panelStyle=o,A.panelPlacement=l,(0,_vue.nextTick)()})}function ae(e){k.value&&E(e),s(e)}function ne(e){var t=W.disabled,a=A.visiblePanel,n=A.isActivated,u=k.value,l=P.value,i=V.value;!t&&n&&(A.isActivated=(0,_dom.getEventTargetNode)(e,l).flag||(0,_dom.getEventTargetNode)(e,i).flag,A.isActivated||(u?a&&(b(),U()):U()))}function ue(e){var t,a,n,u,l,i,r,s,o,c,v,d,f,p,_,m=W.clearable,h=W.disabled,x=A.visiblePanel,y=k.value;h||(h=(0,_event.hasEventKey)(e,_event.EVENT_KEYS.TAB),t=(0,_event.hasEventKey)(e,_event.EVENT_KEYS.DELETE),a=(0,_event.hasEventKey)(e,_event.EVENT_KEYS.ESCAPE),n=(0,_event.hasEventKey)(e,_event.EVENT_KEYS.ENTER),o=(0,_event.hasEventKey)(e,_event.EVENT_KEYS.ARROW_LEFT),u=(0,_event.hasEventKey)(e,_event.EVENT_KEYS.ARROW_UP),s=(0,_event.hasEventKey)(e,_event.EVENT_KEYS.ARROW_RIGHT),l=(0,_event.hasEventKey)(e,_event.EVENT_KEYS.ARROW_DOWN),i=(0,_event.hasEventKey)(e,_event.EVENT_KEYS.PAGE_UP),r=(0,_event.hasEventKey)(e,_event.EVENT_KEYS.PAGE_DOWN),o=o||u||s||l,s=A.isActivated,h?(s&&U(),A.isActivated=s=!1):o?y&&s&&(x?(o=e,f=A.isActivated,p=A.datePanelValue,_=A.datePanelType,f&&(o.preventDefault(),f=(0,_event.hasEventKey)(o,_event.EVENT_KEYS.ARROW_LEFT),c=(0,_event.hasEventKey)(o,_event.EVENT_KEYS.ARROW_UP),v=(0,_event.hasEventKey)(o,_event.EVENT_KEYS.ARROW_RIGHT),o=(0,_event.hasEventKey)(o,_event.EVENT_KEYS.ARROW_DOWN),"year"===_?(d=_xeUtils.default.getWhatYear(p||Date.now(),0,"first"),f?d=_xeUtils.default.getWhatYear(d,-1):c?d=_xeUtils.default.getWhatYear(d,-4):v?d=_xeUtils.default.getWhatYear(d,1):o&&(d=_xeUtils.default.getWhatYear(d,4)),ft(d)):"quarter"===_?(d=_xeUtils.default.getWhatQuarter(p||Date.now(),0,"first"),f?d=_xeUtils.default.getWhatQuarter(d,-1):c?d=_xeUtils.default.getWhatQuarter(d,-2):v?d=_xeUtils.default.getWhatQuarter(d,1):o&&(d=_xeUtils.default.getWhatQuarter(d,2)),pt(d)):"month"===_?(d=_xeUtils.default.getWhatMonth(p||Date.now(),0,"first"),f?d=_xeUtils.default.getWhatMonth(d,-1):c?d=_xeUtils.default.getWhatMonth(d,-4):v?d=_xeUtils.default.getWhatMonth(d,1):o&&(d=_xeUtils.default.getWhatMonth(d,4)),_t(d)):(_=p||_xeUtils.default.getWhatDay(Date.now(),0,"first"),d=g.value,f?_=_xeUtils.default.getWhatDay(_,-1):c?_=_xeUtils.default.getWhatWeek(_,-1,d):v?_=_xeUtils.default.getWhatDay(_,1):o&&(_=_xeUtils.default.getWhatWeek(_,1,d)),dt(_)))):(u||l)&&E(e)):n?y&&(x?A.datePanelValue?ee(A.datePanelValue):b():s&&E(e)):(i||r)&&y&&s&&(p=e,A.isActivated)&&(f=(0,_event.hasEventKey)(p,_event.EVENT_KEYS.PAGE_UP),p.preventDefault(),(f?ct:vt)(p)),h||a?x&&b():t&&m&&s&&S(e,null))}function le(e){var t=W.disabled,a=A.visiblePanel;t||a&&(t=V.value,((0,_dom.getEventTargetNode)(e,t).flag?n:(b(),U))())}function ie(){var e=A.isActivated;A.visiblePanel?(b(),U()):e&&U()}function K(e,t){var a,n=W.festivalMethod;return n?(n=(e=(n=n({type:n=A.datePanelType,viewType:n,date:e.date,$input:i}))?_xeUtils.default.isString(n)?{label:n}:n:{}).extra?_xeUtils.default.isString(e.extra)?{label:e.extra}:e.extra:null,n=[(0,_vue.h)("span",{class:["vxe-input--date-label",{"is-notice":e.notice}]},n&&n.label?[(0,_vue.h)("span",t),(0,_vue.h)("span",{class:["vxe-input--date-label--extra",n.important?"is-important":"",n.className],style:n.style},_xeUtils.default.toValueString(n.label))]:t)],(a=e.label)&&(a=_xeUtils.default.toValueString(a).split(","),n.push((0,_vue.h)("span",{class:["vxe-input--date-festival",e.important?"is-important":"",e.className],style:e.style},[1<a.length?(0,_vue.h)("span",{class:["vxe-input--date-festival--overlap","overlap--".concat(a.length)]},a.map(function(e){return(0,_vue.h)("span",e.substring(0,3))})):(0,_vue.h)("span",{class:"vxe-input--date-festival--label"},a[0].substring(0,3))]))),n):t}function re(){var a,n,u,e,l,i,r,s,o,t,c,v,d,f,p,_,m,h,x,y,g,b,U,E,S,D,P,N,V,w,k,T,M;switch(A.datePanelType){case"week":return h=W.multiple,x=A.datePanelType,y=A.datePanelValue,g=I.value,b=Ye.value,U=Oe.value,E=F.value,S="yyyyMMdd",[(0,_vue.h)("table",{class:"vxe-input--date-".concat(x,"-view"),cellspacing:0,cellpadding:0,border:0},[(0,_vue.h)("thead",[(0,_vue.h)("tr",b.map(function(e){return(0,_vue.h)("th",e.label)}))]),(0,_vue.h)("tbody",U.map(function(e){var t=h?e.some(function(t){return E.some(function(e){return _xeUtils.default.isDateSame(e,t.date,S)})}):e.some(function(e){return _xeUtils.default.isDateSame(g,e.date,S)}),a=e.some(function(e){return _xeUtils.default.isDateSame(y,e.date,S)});return(0,_vue.h)("tr",e.map(function(e){return(0,_vue.h)("td",{class:{"is--prev":e.isPrev,"is--current":e.isCurrent,"is--now":e.isNow,"is--next":e.isNext,"is--disabled":Y(e),"is--selected":t,"is--hover":a},onClick:function(){return C(e)},onMouseenter:function(){return q(e)}},K(e,e.label))}))}))])];case"month":return d=W.multiple,x=A.datePanelType,f=A.datePanelValue,p=I.value,b=Fe.value,_=F.value,m="yyyyMM",[(0,_vue.h)("table",{class:"vxe-input--date-".concat(x,"-view"),cellspacing:0,cellpadding:0,border:0},[(0,_vue.h)("tbody",b.map(function(e){return(0,_vue.h)("tr",e.map(function(t){return(0,_vue.h)("td",{class:{"is--prev":t.isPrev,"is--current":t.isCurrent,"is--now":t.isNow,"is--next":t.isNext,"is--disabled":Y(t),"is--selected":d?_.some(function(e){return _xeUtils.default.isDateSame(e,t.date,m)}):_xeUtils.default.isDateSame(p,t.date,m),"is--hover":_xeUtils.default.isDateSame(f,t.date,m)},onClick:function(){return C(t)},onMouseenter:function(){return q(t)}},K(t,_conf.default.i18n("vxe.input.date.months.m".concat(t.month))))}))}))])];case"quarter":return r=W.multiple,U=A.datePanelType,s=A.datePanelValue,o=I.value,t=Ke.value,c=F.value,v="yyyyq",[(0,_vue.h)("table",{class:"vxe-input--date-".concat(U,"-view"),cellspacing:0,cellpadding:0,border:0},[(0,_vue.h)("tbody",t.map(function(e){return(0,_vue.h)("tr",e.map(function(t){return(0,_vue.h)("td",{class:{"is--prev":t.isPrev,"is--current":t.isCurrent,"is--now":t.isNow,"is--next":t.isNext,"is--disabled":Y(t),"is--selected":r?c.some(function(e){return _xeUtils.default.isDateSame(e,t.date,v)}):_xeUtils.default.isDateSame(o,t.date,v),"is--hover":_xeUtils.default.isDateSame(s,t.date,v)},onClick:function(){return C(t)},onMouseenter:function(){return q(t)}},K(t,_conf.default.i18n("vxe.input.date.quarters.q".concat(t.quarter))))}))}))])];case"year":return a=W.multiple,t=A.datePanelType,n=A.datePanelValue,u=I.value,e=Ce.value,l=F.value,i="yyyy",[(0,_vue.h)("table",{class:"vxe-input--date-".concat(t,"-view"),cellspacing:0,cellpadding:0,border:0},[(0,_vue.h)("tbody",e.map(function(e){return(0,_vue.h)("tr",e.map(function(t){return(0,_vue.h)("td",{class:{"is--prev":t.isPrev,"is--current":t.isCurrent,"is--now":t.isNow,"is--next":t.isNext,"is--disabled":Y(t),"is--selected":a?l.some(function(e){return _xeUtils.default.isDateSame(e,t.date,i)}):_xeUtils.default.isDateSame(u,t.date,i),"is--hover":_xeUtils.default.isDateSame(n,t.date,i)},onClick:function(){return C(t)},onMouseenter:function(){return q(t)}},K(t,t.year))}))}))])]}return D=W.multiple,P=A.datePanelType,N=A.datePanelValue,V=I.value,w=We.value,k=Re.value,T=F.value,M="yyyyMMdd",[(0,_vue.h)("table",{class:"vxe-input--date-".concat(P,"-view"),cellspacing:0,cellpadding:0,border:0},[(0,_vue.h)("thead",[(0,_vue.h)("tr",w.map(function(e){return(0,_vue.h)("th",e.label)}))]),(0,_vue.h)("tbody",k.map(function(e){return(0,_vue.h)("tr",e.map(function(t){return(0,_vue.h)("td",{class:{"is--prev":t.isPrev,"is--current":t.isCurrent,"is--now":t.isNow,"is--next":t.isNext,"is--disabled":Y(t),"is--selected":D?T.some(function(e){return _xeUtils.default.isDateSame(e,t.date,M)}):_xeUtils.default.isDateSame(V,t.date,M),"is--hover":_xeUtils.default.isDateSame(N,t.date,M)},onClick:function(){return C(t)},onMouseenter:function(){return q(t)}},K(t,t.label))}))}))])]}var se,u,oe=e.slots,ce=e.emit,ve=(0,_vue.inject)("$xeform",null),de=(0,_vue.inject)("$xeformiteminfo",null),fe=_xeUtils.default.uniqueId(),pe=(0,_size.useSize)(W),A=(0,_vue.reactive)({inited:!1,panelIndex:0,showPwd:!1,visiblePanel:!1,animatVisible:!1,panelStyle:null,panelPlacement:"",isActivated:!1,inputValue:W.modelValue,datetimePanelValue:null,datePanelValue:null,datePanelLabel:"",datePanelType:"day",selectMonth:null,currentDate:null}),P=(0,_vue.ref)(),N=(0,_vue.ref)(),V=(0,_vue.ref)(),_e=(0,_vue.ref)(),me={refElem:P,refInput:N},i={xID:fe,props:W,context:e,reactData:A,getRefMaps:function(){return me}},r={},o=function(e,t){return"time"===W.type?(0,_date.toStringTimeDate)(e):_xeUtils.default.toStringDate(e,t)},c=(0,_vue.computed)(function(){var e=W.type;return"time"===e||"datetime"===e}),w=(0,_vue.computed)(function(){return-1<["number","integer","float"].indexOf(W.type)}),k=(0,_vue.computed)(function(){return c.value||-1<["date","week","month","quarter","year"].indexOf(W.type)}),T=(0,_vue.computed)(function(){return"password"===W.type}),he=(0,_vue.computed)(function(){return"search"===W.type}),xe=(0,_vue.computed)(function(){return _xeUtils.default.toInteger(W.digits)||1}),ye=(0,_vue.computed)(function(){var e=W.type,t=xe.value,a=W.step;return"integer"===e?_xeUtils.default.toInteger(a)||1:"float"===e?_xeUtils.default.toNumber(a)||1/Math.pow(10,t):_xeUtils.default.toNumber(a)||1}),ge=(0,_vue.computed)(function(){var e=W.type,t=w.value,a=k.value,n=T.value;return W.clearable&&(n||t||a||"text"===e||"search"===e)}),be=(0,_vue.computed)(function(){return W.startDate?_xeUtils.default.toStringDate(W.startDate):null}),Ue=(0,_vue.computed)(function(){return W.endDate?_xeUtils.default.toStringDate(W.endDate):null}),Ee=(0,_vue.computed)(function(){return["date","week","month","quarter","year"].includes(W.type)}),F=(0,_vue.computed)(function(){var e=W.modelValue,t=W.multiple,a=k.value,n=v.value;return t&&e&&a?_xeUtils.default.toValueString(e).split(",").map(function(e){e=o(e,n);return _xeUtils.default.isValidDate(e)?e:null}):[]}),Se=(0,_vue.computed)(function(){var e=F.value,t=v.value;return e.map(function(e){return _xeUtils.default.toDateString(e,t)})}),De=(0,_vue.computed)(function(){var e=F.value,t=d.value;return e.map(function(e){return _xeUtils.default.toDateString(e,t)}).join(", ")}),v=(0,_vue.computed)(function(){var e=W.type;return"time"===e?"HH:mm:ss":W.valueFormat||("datetime"===e?"yyyy-MM-dd HH:mm:ss":"yyyy-MM-dd")}),I=(0,_vue.computed)(function(){var e=W.modelValue,t=k.value,a=v.value,n=null;return n=e&&t&&(t=o(e,a),_xeUtils.default.isValidDate(t))?t:n}),Pe=(0,_vue.computed)(function(){var e=be.value,t=A.selectMonth;return!(!t||!e)&&t<=e}),Ne=(0,_vue.computed)(function(){var e=Ue.value,t=A.selectMonth;return!(!t||!e)&&e<=t}),Ve=(0,_vue.computed)(function(){var e=A.datetimePanelValue;return e?_xeUtils.default.toDateString(e,"HH:mm:ss"):""}),we=(0,_vue.computed)(function(){var e=I.value,t=c.value;return e&&t?1e3*(3600*e.getHours()+60*e.getMinutes()+e.getSeconds()):0}),d=(0,_vue.computed)(function(){return k.value?W.labelFormat||_conf.default.i18n("vxe.input.date.labelFormat.".concat(W.type)):null}),ke=(0,_vue.computed)(function(){var e=A.selectMonth,t=A.currentDate,a=[];if(e&&t)for(var n=t.getFullYear(),t=e.getFullYear(),u=new Date(t-t%yearSize,0,1),l=-4;l<yearSize+4;l++){var i=_xeUtils.default.getWhatYear(u,l,"first"),r=i.getFullYear();a.push({date:i,isCurrent:!0,isPrev:l<0,isNow:n===r,isNext:yearSize<=l,year:r})}return a}),Te=(0,_vue.computed)(function(){var e,t,a,n,u;return k.value?(e=A.datePanelType,t=A.selectMonth,a=ke.value,n="",u=void 0,t&&(n=t.getFullYear(),u=t.getMonth()+1),"quarter"===e?_conf.default.i18n("vxe.input.date.quarterLabel",[n]):"month"===e?_conf.default.i18n("vxe.input.date.monthLabel",[n]):"year"===e?a.length?"".concat(a[0].year," - ").concat(a[a.length-1].year):"":_conf.default.i18n("vxe.input.date.dayLabel",[n,u?_conf.default.i18n("vxe.input.date.m".concat(u)):"-"])):""}),g=(0,_vue.computed)(function(){var e=W.startDay,t=W.startWeek;return _xeUtils.default.toNumber(_xeUtils.default.isNumber(e)||_xeUtils.default.isString(e)?e:t)}),Me=(0,_vue.computed)(function(){var e=[];if(k.value){var t=g.value;e.push(t);for(var a=0;a<6;a++)6<=t?t=0:t++,e.push(t)}return e}),We=(0,_vue.computed)(function(){return k.value?Me.value.map(function(e){return{value:e,label:_conf.default.i18n("vxe.input.date.weeks.w".concat(e))}}):[]}),Ye=(0,_vue.computed)(function(){var e;return k.value?(e=We.value,[{label:_conf.default.i18n("vxe.input.date.weeks.w")}].concat(e)):[]}),Ce=(0,_vue.computed)(function(){var e=ke.value;return _xeUtils.default.chunk(e,4)}),qe=(0,_vue.computed)(function(){var e=A.selectMonth,t=A.currentDate,a=[];if(e&&t)for(var n=t.getFullYear(),u=(0,_date.getDateQuarter)(t),l=_xeUtils.default.getWhatYear(e,0,"first"),i=l.getFullYear(),r=-2;r<quarterSize-2;r++){var s=_xeUtils.default.getWhatQuarter(l,r),o=s.getFullYear(),c=(0,_date.getDateQuarter)(s),v=o<i;a.push({date:s,isPrev:v,isCurrent:o===i,isNow:o===n&&c===u,isNext:!v&&i<o,quarter:c})}return a}),Ke=(0,_vue.computed)(function(){var e=qe.value;return _xeUtils.default.chunk(e,2)}),Ae=(0,_vue.computed)(function(){var e=A.selectMonth,t=A.currentDate,a=[];if(e&&t)for(var n=t.getFullYear(),u=t.getMonth(),l=_xeUtils.default.getWhatYear(e,0,"first").getFullYear(),i=-4;i<monthSize-4;i++){var r=_xeUtils.default.getWhatYear(e,0,i),s=r.getFullYear(),o=r.getMonth(),c=s<l;a.push({date:r,isPrev:c,isCurrent:s===l,isNow:s===n&&o===u,isNext:!c&&l<s,month:o})}return a}),Fe=(0,_vue.computed)(function(){var e=Ae.value;return _xeUtils.default.chunk(e,4)}),Ie=(0,_vue.computed)(function(){var e=A.selectMonth,t=A.currentDate,a=[];if(e&&t)for(var n=we.value,u=Me.value,l=t.getFullYear(),i=t.getMonth(),r=t.getDate(),s=e.getFullYear(),o=e.getMonth(),t=e.getDay(),u=-u.indexOf(t),c=new Date(_xeUtils.default.getWhatDay(e,u).getTime()+n),v=0;v<42;v++){var d=_xeUtils.default.getWhatDay(c,v),f=d.getFullYear(),p=d.getMonth(),_=d.getDate(),m=d<e;a.push({date:d,isPrev:m,isCurrent:f===s&&p===o,isNow:f===l&&p===i&&_===r,isNext:!m&&o!==p,label:_})}return a}),Re=(0,_vue.computed)(function(){var e=Ie.value;return _xeUtils.default.chunk(e,7)}),Oe=(0,_vue.computed)(function(){var e=Re.value,a=g.value;return e.map(function(e){var t=e[0];return[{date:t.date,isWeekNumber:!0,isPrev:!1,isCurrent:!1,isNow:!1,isNext:!1,label:_xeUtils.default.getYearWeek(t.date,a)}].concat(e)})}),ze=(0,_vue.computed)(function(){var e=[];if(c.value)for(var t=0;t<24;t++)e.push({value:t,label:(""+t).padStart(2,"0")});return e}),He=(0,_vue.computed)(function(){var e=[];if(c.value)for(var t=0;t<60;t++)e.push({value:t,label:(""+t).padStart(2,"0")});return e}),Le=(0,_vue.computed)(function(){return He.value}),Ge=(0,_vue.computed)(function(){var e=W.type,t=W.readonly,a=W.editable,n=W.multiple;return t||n||!a||"week"===e||"quarter"===e}),Be=(0,_vue.computed)(function(){var e=W.type,t=A.showPwd,a=w.value,n=k.value,u=T.value;return n||a||u&&t||"number"===e?"text":e}),je=(0,_vue.computed)(function(){var e=W.placeholder;return e?(0,_utils.getFuncText)(e):""}),Qe=(0,_vue.computed)(function(){var e=W.maxlength;return w.value&&!_xeUtils.default.toNumber(e)?16:e}),$e=(0,_vue.computed)(function(){var e=W.type;return W.immediate||!("text"===e||"number"===e||"integer"===e||"float"===e)}),Ze=(0,_vue.computed)(function(){var e=W.type,t=A.inputValue;return w.value?"integer"===e?_xeUtils.default.toInteger((0,_number.handleNumber)(t)):_xeUtils.default.toNumber((0,_number.handleNumber)(t)):0}),Xe=(0,_vue.computed)(function(){var e=W.min,t=A.inputValue,a=w.value,n=Ze.value;return!(!t&&0!==t||!a||null===e)&&n<=_xeUtils.default.toNumber(e)}),Je=(0,_vue.computed)(function(){var e=W.max,t=A.inputValue,a=w.value,n=Ze.value;return!(!t&&0!==t||!a||null===e)&&n>=_xeUtils.default.toNumber(e)}),et=function(e){var t=W.type,a=W.exponential,n=Qe.value,u=xe.value,t="float"===t?(0,_number.toFloatValueFixed)(e,u):_xeUtils.default.toValueString(e);return!a||e!==t&&_xeUtils.default.toValueString(e).toLowerCase()!==_xeUtils.default.toNumber(t).toExponential()?t.slice(0,n):e},s=function(e){var t=A.inputValue;r.dispatchEvent(e.type,{value:t},e)},f=function(e,t){A.inputValue=e,ce("update:modelValue",e),r.dispatchEvent("input",{value:e},t),_xeUtils.default.toValueString(W.modelValue)!==e&&(r.dispatchEvent("change",{value:e},t),ve)&&de&&ve.triggerItemEvent(t,de.itemConfig.field,e)},tt=function(e,t){var a=k.value,n=$e.value;A.inputValue=e,a||(n?f(e,t):r.dispatchEvent("input",{value:e},t))},at=function(e){var t;W.disabled||(t=A.inputValue,r.dispatchEvent("prefix-click",{value:t},e))},b=function(){return new Promise(function(e){A.visiblePanel=!1,se=window.setTimeout(function(){A.animatVisible=!1,e()},350)})},nt=function(e){var t;W.disabled||((0,_dom.hasClass)(e.currentTarget,"is--clear")?(f("",e),S(e,"")):(t=A.inputValue,r.dispatchEvent("suffix-click",{value:t},e)))},p=function(e){var t=W.type,a=W.valueFormat,n=d.value,u=g.value,l=null,i="";e&&(l=o(e,a)),_xeUtils.default.isValidDate(l)?(i=_xeUtils.default.toDateString(l,n,{firstDay:u}),n&&"week"===t&&_xeUtils.default.getWhatWeek(l,0,u,u).getFullYear()<l.getFullYear()&&-1<(e=n.indexOf("yyyy"))&&(a=Number(i.substring(e,e+4)))&&!isNaN(a)&&(i=i.replace("".concat(a),"".concat(a-1)))):l=null,A.datePanelValue=l,A.datePanelLabel=i},ut=function(e){return null===W.max||_xeUtils.default.toNumber(e)<=_xeUtils.default.toNumber(W.max)},lt=function(e){return null===W.min||_xeUtils.default.toNumber(e)>=_xeUtils.default.toNumber(W.min)},it=function(){A.inputValue=W.multiple?De.value:A.datePanelLabel},_=function(e){e=_xeUtils.default.getWhatMonth(e,0,"first");_xeUtils.default.isEqual(e,A.selectMonth)||(A.selectMonth=e)},m=function(t){var e,a,n=W.modelValue,u=W.multiple,l=A.datetimePanelValue,i=c.value,r=v.value,s=g.value,o=("week"===W.type?(e=_xeUtils.default.toNumber(W.selectDay),t=_xeUtils.default.getWhatWeek(t,0,e,s)):i&&(t.setHours(l.getHours()),t.setMinutes(l.getMinutes()),t.setSeconds(l.getSeconds())),_xeUtils.default.toDateString(t,r,{firstDay:s}));_(t),u?(e=Se.value,i?(s=F.value,a=[],s.forEach(function(e){e&&!_xeUtils.default.isDateSame(t,e,"yyyyMMdd")&&(e.setHours(l.getHours()),e.setMinutes(l.getMinutes()),e.setSeconds(l.getSeconds()),a.push(e))}),a.push(t),f(a.map(function(e){return _xeUtils.default.toDateString(e,r)}).join(","),{type:"update"})):e.some(function(e){return _xeUtils.default.isEqual(e,o)})?f(e.filter(function(e){return!_xeUtils.default.isEqual(e,o)}).join(","),{type:"update"}):f(e.concat([o]).join(","),{type:"update"})):_xeUtils.default.isEqual(n,o)||f(o,{type:"update"})},U=function(){var e=W.type,t=W.min,a=W.max,n=W.exponential,u=A.inputValue,l=A.datetimePanelValue,i=w.value,r=k.value,s=d.value;Ge.value||(i?u&&(i="integer"===e?_xeUtils.default.toInteger((0,_number.handleNumber)(u)):_xeUtils.default.toNumber((0,_number.handleNumber)(u)),lt(i)?ut(i)||(i=a):i=t,n&&(a=_xeUtils.default.toValueString(u).toLowerCase())===_xeUtils.default.toNumber(i).toExponential()&&(i=a),f(et(i),{type:"check"})):r&&(u?(t=o(u,s),_xeUtils.default.isValidDate(t)?"time"===e?(u!==(t=_xeUtils.default.toDateString(t,s))&&f(t,{type:"check"}),A.inputValue=t):(n=!1,a=g.value,"datetime"===e?(i=I.value,u===_xeUtils.default.toDateString(i,s)&&u===_xeUtils.default.toDateString(t,s)||(n=!0,l.setHours(t.getHours()),l.setMinutes(t.getMinutes()),l.setSeconds(t.getSeconds()))):n=!0,A.inputValue=_xeUtils.default.toDateString(t,s,{firstDay:a}),n&&m(t)):it()):f("",{type:"check"})))},h=function(e){var t=W.readonly,a=W.disabled,n=Xe.value;clearTimeout(u),a||t||n||L(!1,e),r.dispatchEvent("next-number",{},e)},x=function(e){var t=W.readonly,a=W.disabled,n=Je.value;clearTimeout(u),a||t||n||L(!0,e),r.dispatchEvent("prev-number",{},e)},rt=function(e){var t=(0,_event.hasEventKey)(e,_event.EVENT_KEYS.ARROW_UP),a=(0,_event.hasEventKey)(e,_event.EVENT_KEYS.ARROW_DOWN);(t||a)&&(e.preventDefault(),(t?x:h)(e))},st=function(e,t){A.selectMonth=_xeUtils.default.getWhatMonth(e,t,"first")},ot=function(){var e=_xeUtils.default.getWhatDay(Date.now(),0,"first");A.currentDate=e,st(e,0)},ct=function(e){var t=W.type,a=A.datePanelType,n=A.selectMonth;Pe.value||(A.selectMonth="year"===t?_xeUtils.default.getWhatYear(n,-yearSize,"first"):"month"===t||"quarter"===t?"year"===a?_xeUtils.default.getWhatYear(n,-yearSize,"first"):_xeUtils.default.getWhatYear(n,-1,"first"):"year"===a?_xeUtils.default.getWhatYear(n,-yearSize,"first"):"month"===a?_xeUtils.default.getWhatYear(n,-1,"first"):_xeUtils.default.getWhatMonth(n,-1,"first"),r.dispatchEvent("date-prev",{type:t},e))},vt=function(e){var t=W.type,a=A.datePanelType,n=A.selectMonth;Ne.value||(A.selectMonth="year"===t?_xeUtils.default.getWhatYear(n,yearSize,"first"):"month"===t||"quarter"===t?"year"===a?_xeUtils.default.getWhatYear(n,yearSize,"first"):_xeUtils.default.getWhatYear(n,1,"first"):"year"===a?_xeUtils.default.getWhatYear(n,yearSize,"first"):"month"===a?_xeUtils.default.getWhatYear(n,1,"first"):_xeUtils.default.getWhatMonth(n,1,"first"),r.dispatchEvent("date-next",{type:t},e))},dt=function(t){Y({date:t})||(Ie.value.some(function(e){return _xeUtils.default.isDateSame(e.date,t,"yyyyMMdd")})||_(t),p(t))},ft=function(t){Y({date:t})||(ke.value.some(function(e){return _xeUtils.default.isDateSame(e.date,t,"yyyy")})||_(t),p(t))},pt=function(t){Y({date:t})||(qe.value.some(function(e){return _xeUtils.default.isDateSame(e.date,t,"yyyyq")})||_(t),p(t))},_t=function(t){Y({date:t})||(Ae.value.some(function(e){return _xeUtils.default.isDateSame(e.date,t,"yyyyMM")})||_(t),p(t))},mt=function(e){var t;e&&(t=e.offsetHeight,e.parentNode.scrollTop=e.offsetTop-4*t)},ht=function(){var e=W.disabled,t=A.visiblePanel,a=k.value;return(e||t?(0,_vue.nextTick):(A.inited||(A.inited=!0),clearTimeout(se),A.isActivated=!0,A.animatVisible=!0,a&&(e=W.type,t=c.value,a=I.value,-1<["year","quarter","month","week"].indexOf(e)?A.datePanelType=e:A.datePanelType="day",A.currentDate=_xeUtils.default.getWhatDay(Date.now(),0,"first"),a?(st(a,0),p(a)):ot(),t)&&(A.datetimePanelValue=A.datePanelValue||_xeUtils.default.getWhatDay(Date.now(),0,"first"),(0,_vue.nextTick)(function(){var e=_e.value;_xeUtils.default.arrayEach(e.querySelectorAll("li.is--selected"),mt)})),setTimeout(function(){A.visiblePanel=!0},10),A.panelIndex<(0,_utils.getLastZIndex)()&&(A.panelIndex=(0,_utils.nextZIndex)()),n))()},E=function(e){W.readonly||(e.preventDefault(),ht())},xt=function(){var e=W.multiple,t=A.datePanelType,a=Pe.value,n=Ne.value,u=Te.value;return[(0,_vue.h)("div",{class:"vxe-input--date-picker-header"},[(0,_vue.h)("div",{class:"vxe-input--date-picker-type-wrapper"},["year"===t?(0,_vue.h)("span",{class:"vxe-input--date-picker-label"},u):(0,_vue.h)("span",{class:"vxe-input--date-picker-btn",onClick:X},u)]),(0,_vue.h)("div",{class:"vxe-input--date-picker-btn-wrapper"},[(0,_vue.h)("span",{class:["vxe-input--date-picker-btn vxe-input--date-picker-prev-btn",{"is--disabled":a}],onClick:ct},[(0,_vue.h)("i",{class:"vxe-icon-caret-left"})]),(0,_vue.h)("span",{class:"vxe-input--date-picker-btn vxe-input--date-picker-current-btn",onClick:J},[(0,_vue.h)("i",{class:"vxe-icon-dot"})]),(0,_vue.h)("span",{class:["vxe-input--date-picker-btn vxe-input--date-picker-next-btn",{"is--disabled":n}],onClick:vt},[(0,_vue.h)("i",{class:"vxe-icon-caret-right"})]),e&&Ee.value?(0,_vue.h)("span",{class:"vxe-input--date-picker-btn vxe-input--date-picker-confirm-btn"},[(0,_vue.h)("button",{class:"vxe-input--date-picker-confirm",type:"button",onClick:te},_conf.default.i18n("vxe.button.confirm"))]):null])]),(0,_vue.h)("div",{class:"vxe-input--date-picker-body"},re())]},yt=function(){var a=A.datetimePanelValue,e=Ve.value,t=ze.value,n=He.value,u=Le.value;return[(0,_vue.h)("div",{class:"vxe-input--time-picker-header"},[(0,_vue.h)("span",{class:"vxe-input--time-picker-title"},e),(0,_vue.h)("button",{class:"vxe-input--time-picker-confirm",type:"button",onClick:te},_conf.default.i18n("vxe.button.confirm"))]),(0,_vue.h)("div",{ref:_e,class:"vxe-input--time-picker-body"},[(0,_vue.h)("ul",{class:"vxe-input--time-picker-hour-list"},t.map(function(t,e){return(0,_vue.h)("li",{key:e,class:{"is--selected":a&&a.getHours()===t.value},onClick:function(e){return e=e,A.datetimePanelValue.setHours(t.value),void l(e)}},t.label)})),(0,_vue.h)("ul",{class:"vxe-input--time-picker-minute-list"},n.map(function(t,e){return(0,_vue.h)("li",{key:e,class:{"is--selected":a&&a.getMinutes()===t.value},onClick:function(e){return e=e,A.datetimePanelValue.setMinutes(t.value),void l(e)}},t.label)})),(0,_vue.h)("ul",{class:"vxe-input--time-picker-second-list"},u.map(function(t,e){return(0,_vue.h)("li",{key:e,class:{"is--selected":a&&a.getSeconds()===t.value},onClick:function(e){return e=e,A.datetimePanelValue.setSeconds(t.value),void l(e)}},t.label)}))])]},gt=function(){var e=Je.value,t=Xe.value;return(0,_vue.h)("span",{class:"vxe-input--number-suffix"},[(0,_vue.h)("span",{class:["vxe-input--number-prev is--prev",{"is--disabled":e}],onMousedown:$,onMouseup:a,onMouseleave:a},[(0,_vue.h)("i",{class:["vxe-input--number-prev-icon",_conf.default.icon.INPUT_PREV_NUM]})]),(0,_vue.h)("span",{class:["vxe-input--number-next is--next",{"is--disabled":t}],onMousedown:$,onMouseup:a,onMouseleave:a},[(0,_vue.h)("i",{class:["vxe-input--number-next-icon",_conf.default.icon.INPUT_NEXT_NUM]})])])},bt=function(){return(0,_vue.h)("span",{class:"vxe-input--date-picker-suffix",onClick:E},[(0,_vue.h)("i",{class:["vxe-input--date-picker-icon",_conf.default.icon.INPUT_DATE]})])},Ut=function(){return(0,_vue.h)("span",{class:"vxe-input--search-suffix",onClick:H},[(0,_vue.h)("i",{class:["vxe-input--search-icon",_conf.default.icon.INPUT_SEARCH]})])},Et=function(){var e=A.showPwd;return(0,_vue.h)("span",{class:"vxe-input--password-suffix",onClick:D},[(0,_vue.h)("i",{class:["vxe-input--password-icon",e?_conf.default.icon.INPUT_SHOW_PWD:_conf.default.icon.INPUT_PWD]})])},r={dispatchEvent:function(e,t,a){ce(e,Object.assign({$input:i,$event:a},t))},focus:function(){var e=N.value;return A.isActivated=!0,e.focus(),(0,_vue.nextTick)()},blur:function(){return N.value.blur(),(A.isActivated=!1,_vue.nextTick)()},showPanel:ht,hidePanel:b,updatePlacement:n};Object.assign(i,r),(0,_vue.watch)(function(){return W.modelValue},function(e){A.inputValue=e,y()}),(0,_vue.watch)(function(){return W.type},function(){Object.assign(A,{inputValue:W.modelValue,datetimePanelValue:null,datePanelValue:null,datePanelLabel:"",datePanelType:"day",selectMonth:null,currentDate:null}),t()}),(0,_vue.watch)(d,function(){k.value&&(p(A.datePanelValue),A.inputValue=W.multiple?De.value:A.datePanelLabel)}),(0,_vue.nextTick)(function(){_event.GlobalEvent.on(i,"mousewheel",le),_event.GlobalEvent.on(i,"mousedown",ne),_event.GlobalEvent.on(i,"keydown",ue),_event.GlobalEvent.on(i,"blur",ie)}),(0,_vue.onUnmounted)(function(){a(),_event.GlobalEvent.off(i,"mousewheel"),_event.GlobalEvent.off(i,"mousedown"),_event.GlobalEvent.off(i,"keydown"),_event.GlobalEvent.off(i,"blur")}),t();return i.renderVN=function(){var e,t,a,n,u,l,i=W.className,r=W.controls,s=W.type,o=W.align,c=W.name,v=W.disabled,d=W.readonly,f=W.autocomplete,p=A.inputValue,_=A.visiblePanel,m=A.isActivated,h=pe.value,x=k.value,y=Ge.value,g=Qe.value,b=Be.value,U=je.value,E=[],S=(a=W.prefixIcon,S=oe.prefix,t=[],S?t.push((0,_vue.h)("span",{class:"vxe-input--prefix-icon"},S({}))):a&&t.push((0,_vue.h)("i",{class:["vxe-input--prefix-icon",a]})),t.length?(0,_vue.h)("span",{class:"vxe-input--prefix",onClick:at},t):null),D=(a=W.disabled,t=W.suffixIcon,u=A.inputValue,D=oe.suffix,l=ge.value,n=[],D?n.push((0,_vue.h)("span",{class:"vxe-input--suffix-icon"},D({}))):t&&n.push((0,_vue.h)("i",{class:["vxe-input--suffix-icon",t]})),l&&n.push((0,_vue.h)("i",{class:["vxe-input--clear-icon",_conf.default.icon.INPUT_CLEAR]})),n.length?(0,_vue.h)("span",{class:["vxe-input--suffix",{"is--clear":l&&!a&&!(""===u||_xeUtils.default.eqNull(u))}],onClick:nt},n):null);return S&&E.push(S),E.push((0,_vue.h)("input",{ref:N,class:"vxe-input--inner",value:p,name:c,type:b,placeholder:U,maxlength:g,readonly:y,disabled:v,autocomplete:f,onKeydown:B,onKeyup:j,onWheel:Z,onClick:ae,onInput:M,onChange:R,onFocus:O,onBlur:z})),D&&E.push(D),E.push((t=W.controls,l=w.value,a=k.value,u=T.value,n=he.value,u?e=Et():l?t&&(e=gt()):a?e=bt():n&&(e=Ut()),e?(0,_vue.h)("span",{class:"vxe-input--extra-suffix"},[e]):null)),x&&E.push((p=W.type,c=W.transfer,b=A.inited,U=A.animatVisible,g=A.visiblePanel,y=A.panelPlacement,f=A.panelStyle,u=pe.value,l=[],k.value?(l.push("datetime"===p?(0,_vue.h)("div",{class:"vxe-input--panel-layout-wrapper"},[(0,_vue.h)("div",{class:"vxe-input--panel-left-wrapper"},xt()),(0,_vue.h)("div",{class:"vxe-input--panel-right-wrapper"},yt())]):"time"===p?(0,_vue.h)("div",{class:"vxe-input--panel-wrapper"},yt()):(0,_vue.h)("div",{class:"vxe-input--panel-wrapper"},xt())),(0,_vue.h)(_vue.Teleport,{to:"body",disabled:!c||!b},[(0,_vue.h)("div",{ref:V,class:["vxe-table--ignore-clear vxe-input--panel","type--".concat(p),((b={})["size--".concat(u)]=u,b["is--transfer"]=c,b["animat--leave"]=U,b["animat--enter"]=g,b)],placement:y,style:f},l)])):null)),(0,_vue.h)("div",{ref:P,class:["vxe-input","type--".concat(s),i,((t={})["size--".concat(h)]=h,t["is--".concat(o)]=o,t["is--controls"]=r,t["is--prefix"]=!!S,t["is--suffix"]=!!D,t["is--readonly"]=d,t["is--visivle"]=_,t["is--disabled"]=v,t["is--active"]=m,t)]},E)},i},render:function(){return this.renderVN()}});exports.default=_default;