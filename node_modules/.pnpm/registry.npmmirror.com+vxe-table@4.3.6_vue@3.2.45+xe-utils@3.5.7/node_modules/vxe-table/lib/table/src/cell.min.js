"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=exports.Cell=void 0;var _vue=require("vue"),_xeUtils=_interopRequireDefault(require("xe-utils")),_conf=_interopRequireDefault(require("../../v-x-e-table/src/conf")),_vXETable=require("../../v-x-e-table"),_utils=require("../../tools/utils"),_dom=require("../../tools/dom"),_util=require("./util"),_vn=require("../../tools/vn");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var __assign=function(){return(__assign=Object.assign||function(e){for(var l,r=1,n=arguments.length;r<n;r++)for(var t in l=arguments[r])Object.prototype.hasOwnProperty.call(l,t)&&(e[t]=l[t]);return e}).apply(this,arguments)};function renderHelpIcon(l){var r=l.$table,e=l.column,e=e.titlePrefix||e.titleHelp;return e?[(0,_vue.h)("i",{class:["vxe-cell-help-icon",e.icon||_conf.default.icon.TABLE_HELP],onMouseenter:function(e){r.triggerHeaderHelpEvent(e,l)},onMouseleave:function(e){r.handleTargetLeaveEvent(e)}})]:[]}function renderTitleContent(l,e){var r=l.$table,n=l.column,t=r.props,o=r.internalData,a=r.getComputeMaps().computeTooltipOpts,t=t.showHeaderOverflow,d=n.type,i=n.showHeaderOverflow,c=a.value.showAll,a=_xeUtils.default.isUndefined(i)||_xeUtils.default.isNull(i)?t:i,s="title"===a,u=!0===a||"tooltip"===a,t={};return(s||u||c)&&(t.onMouseenter=function(e){o._isResize||(s?(0,_dom.updateCellTitle)(e.currentTarget,n):(u||c)&&r.triggerHeaderTooltipEvent(e,l))}),(u||c)&&(t.onMouseleave=function(e){o._isResize||(u||c)&&r.handleTargetLeaveEvent(e)}),["html"===d&&_xeUtils.default.isString(e)?(0,_vue.h)("span",__assign({class:"vxe-cell--title",innerHTML:e},t)):(0,_vue.h)("span",__assign({class:"vxe-cell--title"},t),e)]}function getFooterContent(e){var l=e.$table,r=e.column,n=e._columnIndex,t=e.items,o=r.slots,a=r.editRender,r=r.cellRender,a=a||r,r=o?o.footer:null;if(r)return l.callSlot(r,e);if(a){o=_vXETable.VXETable.renderer.get(a.name);if(o&&o.renderFooter)return(0,_vn.getSlotVNs)(o.renderFooter(a,e))}return[(0,_utils.formatText)(t[n],1)]}function getDefaultCellLabel(e){var l=e.$table,r=e.row,e=e.column;return(0,_utils.formatText)(l.getCellLabel(r,e),1)}var Cell={createColumn:function(e,l){var r=l.type,n=l.sortable,t=l.filters,o=l.editRender,a=l.treeNode,d=e.props.editConfig,i=e.getComputeMaps(),c=i.computeEditOpts,s=i.computeCheckboxOpts.value,u=c.value,C={renderHeader:Cell.renderDefaultHeader,renderCell:a?Cell.renderTreeCell:Cell.renderDefaultCell,renderFooter:Cell.renderDefaultFooter};switch(r){case"seq":C.renderHeader=Cell.renderSeqHeader,C.renderCell=a?Cell.renderTreeIndexCell:Cell.renderSeqCell;break;case"radio":C.renderHeader=Cell.renderRadioHeader,C.renderCell=a?Cell.renderTreeRadioCell:Cell.renderRadioCell;break;case"checkbox":C.renderHeader=Cell.renderCheckboxHeader,C.renderCell=s.checkField?a?Cell.renderTreeSelectionCellByProp:Cell.renderCheckboxCellByProp:a?Cell.renderTreeSelectionCell:Cell.renderCheckboxCell;break;case"expand":C.renderCell=Cell.renderExpandCell,C.renderData=Cell.renderExpandData;break;case"html":C.renderCell=a?Cell.renderTreeHTMLCell:Cell.renderHTMLCell,t&&n?C.renderHeader=Cell.renderSortAndFilterHeader:n?C.renderHeader=Cell.renderSortHeader:t&&(C.renderHeader=Cell.renderFilterHeader);break;default:d&&o?(C.renderHeader=Cell.renderEditHeader,C.renderCell="cell"===u.mode?a?Cell.renderTreeCellEdit:Cell.renderCellEdit:a?Cell.renderTreeRowEdit:Cell.renderRowEdit):t&&n?C.renderHeader=Cell.renderSortAndFilterHeader:n?C.renderHeader=Cell.renderSortHeader:t&&(C.renderHeader=Cell.renderFilterHeader)}return(0,_util.createColumn)(e,l,C)},renderHeaderTitle:function(e){var l=e.$table,r=e.column,n=r.slots,t=r.editRender,o=r.cellRender,t=t||o,o=n?n.header:null;if(o)return renderTitleContent(e,l.callSlot(o,e));if(t){n=_vXETable.VXETable.renderer.get(t.name);if(n&&n.renderHeader)return renderTitleContent(e,(0,_vn.getSlotVNs)(n.renderHeader(t,e)))}return renderTitleContent(e,[(0,_utils.formatText)(r.getTitle(),1)])},renderDefaultHeader:function(e){return renderHelpIcon(e).concat(Cell.renderHeaderTitle(e))},renderDefaultCell:function(e){var l=e.$table,r=e.row,n=e.column,t=n.slots,o=n.editRender,a=n.cellRender,a=o||a,t=t?t.default:null;if(t)return l.callSlot(t,e);if(a){var t=o?"renderCell":"renderDefault",d=_vXETable.VXETable.renderer.get(a.name),d=d?d[t]:null;if(d)return(0,_vn.getSlotVNs)(d(a,Object.assign({$type:o?"edit":"cell"},e)))}t=l.getCellLabel(r,n),d=o?o.placeholder:"";return[(0,_vue.h)("span",{class:"vxe-cell--label"},o&&(0,_utils.eqEmptyValue)(t)?[(0,_vue.h)("span",{class:"vxe-cell--placeholder"},(0,_utils.formatText)((0,_utils.getFuncText)(d),1))]:(0,_utils.formatText)(t,1))]},renderTreeCell:function(e){return Cell.renderTreeIcon(e,Cell.renderDefaultCell(e))},renderDefaultFooter:function(e){return[(0,_vue.h)("span",{class:"vxe-cell--item"},getFooterContent(e))]},renderTreeIcon:function(l,e){var r=l.$table,n=l.isHidden,t=r.reactData,o=r.getComputeMaps().computeTreeOpts,a=t.treeExpandeds,t=t.treeLazyLoadeds,o=o.value,d=l.row,i=l.column,c=l.level,i=i.slots,s=o.children,u=o.hasChild,C=o.indent,f=o.lazy,_=o.trigger,v=o.iconLoaded,p=o.showIcon,E=o.iconOpen,o=o.iconClose,s=d[s],i=i?i.icon:null,h=!1,b=!1,x=!1,T={};return i?r.callSlot(i,l):(n||(b=-1<r.findRowIndexOf(a,d),f&&(x=-1<r.findRowIndexOf(t,d),h=d[u])),_&&"default"!==_||(T.onClick=function(e){return r.triggerTreeExpandEvent(e,l)}),[(0,_vue.h)("div",{class:["vxe-cell--tree-node",{"is--active":b}],style:{paddingLeft:"".concat(c*C,"px")}},[p&&(s&&s.length||h)?[(0,_vue.h)("div",__assign({class:"vxe-tree--btn-wrapper"},T),[(0,_vue.h)("i",{class:["vxe-tree--node-btn",x?v||_conf.default.icon.TABLE_TREE_LOADED:b?E||_conf.default.icon.TABLE_TREE_OPEN:o||_conf.default.icon.TABLE_TREE_CLOSE]})])]:null,(0,_vue.h)("div",{class:"vxe-tree-cell"},e)])])},renderSeqHeader:function(e){var l=e.$table,r=e.column,n=r.slots,n=n?n.header:null;return renderTitleContent(e,n?l.callSlot(n,e):[(0,_utils.formatText)(r.getTitle(),1)])},renderSeqCell:function(e){var l=e.$table,r=e.column,n=l.props.treeConfig,t=l.getComputeMaps().computeSeqOpts.value,r=r.slots,r=r?r.default:null;return r?l.callSlot(r,e):(l=e.seq,r=t.seqMethod,[(0,_utils.formatText)(r?r(e):n?l:(t.startIndex||0)+l,1)])},renderTreeIndexCell:function(e){return Cell.renderTreeIcon(e,Cell.renderSeqCell(e))},renderRadioHeader:function(e){var l=e.$table,r=e.column,n=r.slots,t=n?n.header:null,n=n?n.title:null;return renderTitleContent(e,t?l.callSlot(t,e):[(0,_vue.h)("span",{class:"vxe-radio--label"},n?l.callSlot(n,e):(0,_utils.formatText)(r.getTitle(),1))])},renderRadioCell:function(l){var e,r=l.$table,n=l.column,t=l.isHidden,o=r.reactData,a=r.getComputeMaps().computeRadioOpts,o=o.selectRow,a=a.value,n=n.slots,d=a.labelField,i=a.checkMethod,a=a.visibleMethod,c=l.row,s=n?n.default:null,n=n?n.radio:null,o=c===o,u=!a||a({row:c}),C=!!i,a=(t||(e={onClick:function(e){!C&&u&&r.triggerRadioRowEvent(e,l)}},i&&(C=!i({row:c}))),__assign(__assign({},l),{checked:o,disabled:C,visible:u}));return n?r.callSlot(n,a):(t=[],u&&t.push((0,_vue.h)("span",{class:["vxe-radio--icon",o?_conf.default.icon.TABLE_RADIO_CHECKED:_conf.default.icon.TABLE_RADIO_UNCHECKED]})),(s||d)&&t.push((0,_vue.h)("span",{class:"vxe-radio--label"},s?r.callSlot(s,a):_xeUtils.default.get(c,d))),[(0,_vue.h)("span",__assign({class:["vxe-cell--radio",{"is--checked":o,"is--disabled":C}]},e),t)])},renderTreeRadioCell:function(e){return Cell.renderTreeIcon(e,Cell.renderRadioCell(e))},renderCheckboxHeader:function(e){var l,r=e.$table,n=e.column,t=e.isHidden,o=r.reactData,a=r.getComputeMaps(),d=a.computeIsAllCheckboxDisabled,a=a.computeCheckboxOpts,i=o.isAllSelected,o=o.isIndeterminate,c=d.value,d=n.slots,s=d?d.header:null,d=d?d.title:null,a=a.value,n=n.getTitle(),t=(t||(l={onClick:function(e){c||r.triggerCheckAllEvent(e,!i)}}),__assign(__assign({},e),{checked:i,disabled:c,indeterminate:o}));return s?renderTitleContent(t,r.callSlot(s,t)):(a.checkStrictly?a.showHeader:!1!==a.showHeader)?renderTitleContent(t,[(0,_vue.h)("span",__assign({class:["vxe-cell--checkbox",{"is--checked":i,"is--disabled":c,"is--indeterminate":o}],title:_conf.default.i18n("vxe.table.allTitle")},l),[(0,_vue.h)("span",{class:["vxe-checkbox--icon",o?_conf.default.icon.TABLE_CHECKBOX_INDETERMINATE:i?_conf.default.icon.TABLE_CHECKBOX_CHECKED:_conf.default.icon.TABLE_CHECKBOX_UNCHECKED]})].concat(d||n?[(0,_vue.h)("span",{class:"vxe-checkbox--label"},d?r.callSlot(d,t):n)]:[]))]):renderTitleContent(t,[(0,_vue.h)("span",{class:"vxe-checkbox--label"},d?r.callSlot(d,t):n)])},renderCheckboxCell:function(l){var e,r=l.$table,n=l.row,t=l.column,o=l.isHidden,a=r.props,d=r.reactData,a=a.treeConfig,i=d.selection,d=d.treeIndeterminates,c=r.getComputeMaps().computeCheckboxOpts.value,s=c.labelField,u=c.checkMethod,c=c.visibleMethod,t=t.slots,C=t?t.default:null,t=t?t.checkbox:null,f=!1,_=!1,v=!c||c({row:n}),p=!!u,c=(o||(_=-1<r.findRowIndexOf(i,n),e={onClick:function(e){!p&&v&&r.triggerCheckRowEvent(e,l,!_)}},u&&(p=!u({row:n})),a&&(f=-1<r.findRowIndexOf(d,n))),__assign(__assign({},l),{checked:_,disabled:p,visible:v,indeterminate:f}));return t?r.callSlot(t,c):(o=[],v&&o.push((0,_vue.h)("span",{class:["vxe-checkbox--icon",f?_conf.default.icon.TABLE_CHECKBOX_INDETERMINATE:_?_conf.default.icon.TABLE_CHECKBOX_CHECKED:_conf.default.icon.TABLE_CHECKBOX_UNCHECKED]})),(C||s)&&o.push((0,_vue.h)("span",{class:"vxe-checkbox--label"},C?r.callSlot(C,c):_xeUtils.default.get(n,s))),[(0,_vue.h)("span",__assign({class:["vxe-cell--checkbox",{"is--checked":_,"is--disabled":p,"is--indeterminate":f}]},e),o)])},renderTreeSelectionCell:function(e){return Cell.renderTreeIcon(e,Cell.renderCheckboxCell(e))},renderCheckboxCellByProp:function(l){var e,r=l.$table,n=l.row,t=l.column,o=l.isHidden,a=r.props,d=r.reactData,a=a.treeConfig,d=d.treeIndeterminates,i=r.getComputeMaps().computeCheckboxOpts.value,c=i.labelField,s=i.checkField,u=i.halfField,C=i.checkMethod,i=i.visibleMethod,t=t.slots,f=t?t.default:null,t=t?t.checkbox:null,_=!1,v=!1,p=!i||i({row:n}),E=!!C,i=(o||(v=_xeUtils.default.get(n,s),e={onClick:function(e){!E&&p&&r.triggerCheckRowEvent(e,l,!v)}},C&&(E=!C({row:n})),a&&(_=-1<r.findRowIndexOf(d,n))),__assign(__assign({},l),{checked:v,disabled:E,visible:p,indeterminate:_}));return t?r.callSlot(t,i):(o=[],p&&(o.push((0,_vue.h)("span",{class:["vxe-checkbox--icon",_?_conf.default.icon.TABLE_CHECKBOX_INDETERMINATE:v?_conf.default.icon.TABLE_CHECKBOX_CHECKED:_conf.default.icon.TABLE_CHECKBOX_UNCHECKED]})),f||c)&&o.push((0,_vue.h)("span",{class:"vxe-checkbox--label"},f?r.callSlot(f,i):_xeUtils.default.get(n,c))),[(0,_vue.h)("span",__assign({class:["vxe-cell--checkbox",{"is--checked":v,"is--disabled":E,"is--indeterminate":u&&!v?n[u]:_}]},e),o)])},renderTreeSelectionCellByProp:function(e){return Cell.renderTreeIcon(e,Cell.renderCheckboxCellByProp(e))},renderExpandCell:function(l){var r=l.$table,e=l.isHidden,n=l.row,t=l.column,o=r.reactData,a=o.rowExpandeds,o=o.expandLazyLoadeds,d=r.getComputeMaps().computeExpandOpts.value,i=d.lazy,c=d.labelField,s=d.iconLoaded,u=d.showIcon,C=d.iconOpen,f=d.iconClose,d=d.visibleMethod,t=t.slots,_=t?t.default:null,t=t?t.icon:null,v=!1,p=!1;return t?r.callSlot(t,l):(e||(v=-1<r.findRowIndexOf(a,l.row),i&&(p=-1<r.findRowIndexOf(o,n))),[!u||d&&!d(l)?null:(0,_vue.h)("span",{class:["vxe-table--expanded",{"is--active":v}],onClick:function(e){r.triggerRowExpandEvent(e,l)}},[(0,_vue.h)("i",{class:["vxe-table--expand-btn",p?s||_conf.default.icon.TABLE_EXPAND_LOADED:v?C||_conf.default.icon.TABLE_EXPAND_OPEN:f||_conf.default.icon.TABLE_EXPAND_CLOSE]})]),_||c?(0,_vue.h)("span",{class:"vxe-table--expand-label"},_?r.callSlot(_,l):_xeUtils.default.get(n,c)):null])},renderExpandData:function(e){var l=e.$table,r=e.column,n=r.slots,r=r.contentRender,n=n?n.content:null;if(n)return l.callSlot(n,e);if(r){l=_vXETable.VXETable.renderer.get(r.name);if(l&&l.renderExpand)return(0,_vn.getSlotVNs)(l.renderExpand(r,e))}return[]},renderHTMLCell:function(e){var l=e.$table,r=e.column.slots,r=r?r.default:null;return r?l.callSlot(r,e):[(0,_vue.h)("span",{class:"vxe-cell--html",innerHTML:getDefaultCellLabel(e)})]},renderTreeHTMLCell:function(e){return Cell.renderTreeIcon(e,Cell.renderHTMLCell(e))},renderSortAndFilterHeader:function(e){return Cell.renderDefaultHeader(e).concat(Cell.renderSortIcon(e)).concat(Cell.renderFilterIcon(e))},renderSortHeader:function(e){return Cell.renderDefaultHeader(e).concat(Cell.renderSortIcon(e))},renderSortIcon:function(e){var l=e.$table,r=e.column,e=l.getComputeMaps().computeSortOpts.value,n=e.showIcon,t=e.iconAsc,e=e.iconDesc,o=r.order;return n?[(0,_vue.h)("span",{class:"vxe-cell--sort"},[(0,_vue.h)("i",{class:["vxe-sort--asc-btn",t||_conf.default.icon.TABLE_SORT_ASC,{"sort--active":"asc"===o}],title:_conf.default.i18n("vxe.table.sortAsc"),onClick:function(e){l.triggerSortEvent(e,r,"asc")}}),(0,_vue.h)("i",{class:["vxe-sort--desc-btn",e||_conf.default.icon.TABLE_SORT_DESC,{"sort--active":"desc"===o}],title:_conf.default.i18n("vxe.table.sortDesc"),onClick:function(e){l.triggerSortEvent(e,r,"desc")}})])]:[]},renderFilterHeader:function(e){return Cell.renderDefaultHeader(e).concat(Cell.renderFilterIcon(e))},renderFilterIcon:function(l){var r=l.$table,e=l.column,n=l.hasFilter,t=r.reactData.filterStore,o=r.getComputeMaps().computeFilterOpts.value,a=o.showIcon,d=o.iconNone,o=o.iconMatch;return a?[(0,_vue.h)("span",{class:["vxe-cell--filter",{"is--active":t.visible&&t.column===e}]},[(0,_vue.h)("i",{class:["vxe-filter--btn",n?o||_conf.default.icon.TABLE_FILTER_MATCH:d||_conf.default.icon.TABLE_FILTER_NONE],title:_conf.default.i18n("vxe.table.filter"),onClick:function(e){r.triggerFilterEvent(e,l.column,l)}})])]:[]},renderEditHeader:function(e){var l=e.$table,r=e.column,n=l.props,l=l.getComputeMaps().computeEditOpts,t=n.editConfig,n=n.editRules,l=l.value,o=r.sortable,a=r.filters,d=r.editRender,i=!1;return n&&(n=_xeUtils.default.get(n,r.field))&&(i=n.some(function(e){return e.required})),((0,_utils.isEnableConf)(t)?[i&&l.showAsterisk?(0,_vue.h)("i",{class:"vxe-cell--required-icon"}):null,(0,_utils.isEnableConf)(d)&&l.showIcon?(0,_vue.h)("i",{class:["vxe-cell--edit-icon",l.icon||_conf.default.icon.TABLE_EDIT]}):null]:[]).concat(Cell.renderDefaultHeader(e)).concat(o?Cell.renderSortIcon(e):[]).concat(a?Cell.renderFilterIcon(e):[])},renderRowEdit:function(e){var l=e.$table,r=e.column,l=l.reactData.editStore.actived,r=r.editRender;return Cell.runRenderer(e,(0,_utils.isEnableConf)(r)&&l&&l.row===e.row)},renderTreeRowEdit:function(e){return Cell.renderTreeIcon(e,Cell.renderRowEdit(e))},renderCellEdit:function(e){var l=e.$table,r=e.column,l=l.reactData.editStore.actived,r=r.editRender;return Cell.runRenderer(e,(0,_utils.isEnableConf)(r)&&l&&l.row===e.row&&l.column===e.column)},renderTreeCellEdit:function(e){return Cell.renderTreeIcon(e,Cell.renderCellEdit(e))},runRenderer:function(e,l){var r=e.$table,n=e.column,t=n.slots,o=n.editRender,n=n.formatter,a=t?t.default:null,t=t?t.edit:null,d=_vXETable.VXETable.renderer.get(o.name);return l?t?r.callSlot(t,e):d&&d.renderEdit?(0,_vn.getSlotVNs)(d.renderEdit(o,Object.assign({$type:"edit"},e))):[]:a?r.callSlot(a,e):n?[(0,_vue.h)("span",{class:"vxe-cell--label"},getDefaultCellLabel(e))]:Cell.renderDefaultCell(e)}},_default=exports.Cell=Cell;exports.default=_default;