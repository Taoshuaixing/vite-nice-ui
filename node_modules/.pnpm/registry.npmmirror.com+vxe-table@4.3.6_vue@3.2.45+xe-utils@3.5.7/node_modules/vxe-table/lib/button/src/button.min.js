"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _vue=require("vue"),_xeUtils=_interopRequireDefault(require("xe-utils")),_conf=_interopRequireDefault(require("../../v-x-e-table/src/conf")),_size=require("../../hooks/size"),_dom=require("../../tools/dom"),_utils=require("../../tools/utils"),_event=require("../../tools/event");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var _default=(0,_vue.defineComponent)({name:"VxeButton",props:{type:String,className:String,size:{type:String,default:function(){return _conf.default.button.size||_conf.default.size}},name:[String,Number],content:String,placement:String,status:String,icon:String,round:Boolean,circle:Boolean,disabled:Boolean,loading:Boolean,destroyOnClose:Boolean,transfer:{type:Boolean,default:function(){return _conf.default.button.transfer}}},emits:["click","dropdown-click"],setup:function(m,e){function _(e){u.dispatchEvent("click",{$event:e},e)}function b(e){0===e.button&&e.stopPropagation()}function h(e){var t=e.currentTarget,n=z.value,o=(t=(0,_dom.getEventTargetNode)(e,t,"vxe-button")).flag,t=t.targetElem;o&&(n&&(n.dataset.active="N"),P.showPanel=!1,setTimeout(function(){n&&"Y"===n.dataset.active||(P.animatVisible=!1)},350),u.dispatchEvent("dropdown-click",{name:t.getAttribute("name"),$event:e},e))}function x(){var e=z.value;e&&(e.dataset.active="Y",P.inited||(P.inited=!0),n.showTime=setTimeout(function(){"Y"===e.dataset.active?q():P.animatVisible=!1},250))}function g(){l()}function w(){var e=m.content,t=m.icon,n=[];return m.loading?n.push((0,_vue.h)("i",{class:["vxe-button--loading-icon",_conf.default.icon.BUTTON_LOADING]})):T.icon?n.push((0,_vue.h)("span",{class:"vxe-button--custom-icon"},T.icon({}))):t&&n.push((0,_vue.h)("i",{class:["vxe-button--icon",t]})),T.default?n.push((0,_vue.h)("span",{class:"vxe-button--content"},T.default({}))):e&&n.push((0,_vue.h)("span",{class:"vxe-button--content"},(0,_utils.getFuncText)(e))),n}var T=e.slots,o=e.emit,t=_xeUtils.default.uniqueId(),y=(0,_size.useSize)(m),P=(0,_vue.reactive)({inited:!1,showPanel:!1,animatVisible:!1,panelIndex:0,panelStyle:{},panelPlacement:""}),n={showTime:null},N=(0,_vue.ref)(),k=(0,_vue.ref)(),z=(0,_vue.ref)(),a={refElem:N},i={xID:t,props:m,context:e,reactData:P,internalData:n,getRefMaps:function(){return a}},u={},O=(0,_vue.computed)(function(){var e=m.type;return!!e&&-1<["submit","reset","button"].indexOf(e)}),S=(0,_vue.computed)(function(){var e=m.type;return e&&"text"===e?e:"button"}),s=function(){P.panelIndex<(0,_utils.getLastZIndex)()&&(P.panelIndex=(0,_utils.nextZIndex)())},c=function(){return(0,_vue.nextTick)().then(function(){var e,t,n,o,a,i,u,s,c=m.transfer,l=m.placement,r=P.panelIndex,d=k.value,v=z.value;if(v&&d)return e=d.offsetHeight,t=d.offsetWidth,n=v.offsetHeight,v=v.offsetWidth,r={zIndex:r},s=(d=(0,_dom.getAbsolutePos)(d)).top,o=d.left,a=d.boundingTop,i=d.visibleHeight,d=d.visibleWidth,u="bottom",c?(c=s+e,"top"===l?(u="top",c=s-n):l||(i<a+e+n+5&&(u="top",c=s-n),c<5&&(u="bottom",c=s+e)),d<(s=o+t-v)+v+5&&(s-=s+v+5-d),s<5&&(s=5),Object.assign(r,{left:"".concat(s,"px"),right:"auto",top:"".concat(c,"px"),minWidth:"".concat(t,"px")})):"top"===l?(u="top",r.bottom="".concat(e,"px")):l||i<a+e+n&&5<a-e-n&&(u="top",r.bottom="".concat(e,"px")),P.panelStyle=r,P.panelPlacement=u,(0,_vue.nextTick)()})},q=function(){var e=z.value;e&&(e.dataset.active="Y",P.animatVisible=!0,setTimeout(function(){"Y"===e.dataset.active&&(P.showPanel=!0,s(),c(),setTimeout(function(){P.showPanel&&c()},50))},20))},l=function(){var e=z.value;clearTimeout(n.showTime),e?(e.dataset.active="N",setTimeout(function(){"Y"!==e.dataset.active&&(P.showPanel=!1,setTimeout(function(){"Y"!==e.dataset.active&&(P.animatVisible=!1)},350))},100)):(P.animatVisible=!1,P.showPanel=!1)},u={dispatchEvent:function(e,t,n){o(e,Object.assign({$button:i,$event:n},t))},focus:function(){return k.value.focus(),(0,_vue.nextTick)()},blur:function(){return k.value.blur(),(0,_vue.nextTick)()}};Object.assign(i,u),(0,_vue.onMounted)(function(){_event.GlobalEvent.on(i,"mousewheel",function(e){var t=z.value;P.showPanel&&!(0,_dom.getEventTargetNode)(e,t).flag&&l()})}),(0,_vue.onUnmounted)(function(){_event.GlobalEvent.off(i,"mousewheel")});return i.renderVN=function(){var e=m.className,t=m.transfer,n=m.type,o=m.round,a=m.circle,i=m.destroyOnClose,u=m.status,s=m.name,c=m.disabled,l=m.loading,r=P.inited,d=P.showPanel,v=O.value,f=S.value,p=y.value;return T.dropdowns?(0,_vue.h)("div",{ref:N,class:["vxe-button--dropdown",e,((e={})["size--".concat(p)]=p,e["is--active"]=d,e)]},[(0,_vue.h)("button",{ref:k,class:["vxe-button","type--".concat(f),((e={})["size--".concat(p)]=p,e["theme--".concat(u)]=u,e["is--round"]=o,e["is--circle"]=a,e["is--disabled"]=c||l,e["is--loading"]=l,e)],name:s,type:v?n:"button",disabled:c||l,onMouseenter:x,onMouseleave:g,onClick:_},w().concat([(0,_vue.h)("i",{class:"vxe-button--dropdown-arrow ".concat(_conf.default.icon.BUTTON_DROPDOWN)})])),(0,_vue.h)(_vue.Teleport,{to:"body",disabled:!t||!r},[(0,_vue.h)("div",{ref:z,class:["vxe-button--dropdown-panel",((e={})["size--".concat(p)]=p,e["animat--leave"]=P.animatVisible,e["animat--enter"]=d,e)],placement:P.panelPlacement,style:P.panelStyle},r?[(0,_vue.h)("div",{class:"vxe-button--dropdown-wrapper",onMousedown:b,onClick:h,onMouseenter:q,onMouseleave:g},i&&!d?[]:T.dropdowns({}))]:[])])]):(0,_vue.h)("button",{ref:k,class:["vxe-button","type--".concat(f),((t={})["size--".concat(p)]=p,t["theme--".concat(u)]=u,t["is--round"]=o,t["is--circle"]=a,t["is--disabled"]=c||l,t["is--loading"]=l,t)],name:s,type:v?n:"button",disabled:c||l,onClick:_},w())},i},render:function(){return this.renderVN()}});exports.default=_default;